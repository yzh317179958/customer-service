# AI æ™ºèƒ½å®¢æœ - è¿›åº¦è¿½è¸ª

> **ç‰ˆæœ¬**: v7.7.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-24
> **å½“å‰çŠ¶æ€**: v7.7.0 å¼€å‘ä¸­

---

## ä¸€ã€ç‰ˆæœ¬å†å²

### v7.6.x - æ ¸å¿ƒåŠŸèƒ½å®Œæˆ

**å®Œæˆæ—¶é—´**: 2025-12-23
**çŠ¶æ€**: âœ… å·²ä¸Šçº¿

**å·²å®ŒæˆåŠŸèƒ½**:

| åŠŸèƒ½ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| Coze å·¥ä½œæµé›†æˆ | ä¼šè¯éš”ç¦»ã€æµå¼å“åº”ã€å¤šè½®å¯¹è¯ | âœ… |
| è®¢å•æŸ¥è¯¢ | Shopify å¤šç«™ç‚¹ã€ç¼“å­˜æœºåˆ¶ | âœ… |
| ç‰©æµè¿½è¸ª | 17track APIã€è‡ªåŠ¨æ³¨å†Œã€æ—¶é—´çº¿ | âœ… |
| äººå·¥è½¬æ¥ | çŠ¶æ€æœºã€ç­æ¬¡æ§åˆ¶ã€SSE æ¨é€ | âœ… |
| å‰ç«¯äº¤äº’ | Vue 3 + Piniaã€å¿«æ·å›å¤ã€æ¶ˆæ¯æ°”æ³¡ | âœ… |

**API ç«¯ç‚¹ç»Ÿè®¡**:

| Handler | ç«¯ç‚¹æ•° | è¯´æ˜ |
|---------|--------|------|
| chat.py | 3 | åŒæ­¥èŠå¤©ã€æµå¼èŠå¤©ã€æœºå™¨äººä¿¡æ¯ |
| conversation.py | 3 | åˆ›å»ºä¼šè¯ã€æ–°å»ºå¯¹è¯ã€æ¸…é™¤å†å² |
| config.py | 6 | é…ç½®ä¿¡æ¯ã€å¥åº·æ£€æŸ¥ã€ç­æ¬¡ã€Token |
| manual.py | 2 | äººå·¥å‡çº§ã€äººå·¥æ¶ˆæ¯å†™å…¥ |
| tracking.py | 2 | ç‰©æµè½¨è¿¹ã€ç‰©æµçŠ¶æ€ |

**æ€»è®¡**: 16 ä¸ª API ç«¯ç‚¹

---

## äºŒã€v7.7.0 å¼€å‘è¿›åº¦

### Phase 1 - P0 æ ¸å¿ƒåŠŸèƒ½

| Step | ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¶é—´ |
|------|------|------|----------|
| 1.1 | TrackingStatus æšä¸¾è‹±æ–‡åŒ– | âœ… å·²å®Œæˆ | 2025-12-24 |
| 1.2 | API å“åº”é»˜è®¤è¿”å›è‹±æ–‡ | âœ… å·²å®Œæˆ | 2025-12-24 |
| 1.3 | å‰ç«¯ UI æ–‡æ¡ˆè‹±æ–‡åŒ– | âœ… å·²å®Œæˆ | 2025-12-24 |
| 1.4 | æç¤ºè¯è‹±æ–‡åŒ– | âœ… å·²å®Œæˆ | 2025-12-24 |
| 1.5 | UserIntent æšä¸¾å®šä¹‰ | âœ… å·²å®Œæˆ | 2025-12-24 |
| 1.6 | chat.py å¤„ç† intent å‚æ•° | âœ… å·²å®Œæˆ | 2025-12-24 |
| 1.7 | å”®åæµç¨‹çŠ¶æ€æœº | âœ… å·²å®Œæˆ | 2025-12-24 |
| 1.8 | UI ç´ ææ›¿æ¢ | âœ… å·²å®Œæˆ | 2025-12-24 |

**Phase 1 è¿›åº¦**: 8/8 (100%) âœ…

---

### Phase 2 - P1 é‡è¦åŠŸèƒ½

| Step | ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¶é—´ |
|------|------|------|----------|
| 2.1 | æ·»åŠ  slowapi ä¾èµ– | â¬œ å¾…å¼€å‘ | - |
| 2.2 | main.py é›†æˆé™æµä¸­é—´ä»¶ | â¬œ å¾…å¼€å‘ | - |
| 2.3 | chat ç«¯ç‚¹æ·»åŠ é™æµè£…é¥°å™¨ | â¬œ å¾…å¼€å‘ | - |
| 2.4 | ç›‘æ§æŒ‡æ ‡ç«¯ç‚¹ | â¬œ å¾…å¼€å‘ | - |

**Phase 2 è¿›åº¦**: 0/4 (0%)

---

### Phase 3 - P2 æ‰©å±•åŠŸèƒ½

| Step | ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¶é—´ |
|------|------|------|----------|
| 3.1 | å¤šè¯­è¨€åŠ¨æ€åˆ‡æ¢ | â¬œ è§„åˆ’ä¸­ | - |
| 3.2 | ä¼šè¯å†å²æŒä¹…åŒ–ï¼ˆè·¨æ¨¡å—ï¼šchat-history-storageï¼‰ | ğŸš§ å¼€å‘ä¸­ | 2026-01-07 |
| 3.3 | å¯Œåª’ä½“æ¶ˆæ¯æ”¯æŒ | â¬œ è§„åˆ’ä¸­ | - |

**Phase 3 è¿›åº¦**: 0/3 (0%)

---

## ä¸‰ã€è·¨æ¨¡å—åŠŸèƒ½è¿›åº¦ï¼šèŠå¤©è®°å½•å­˜å‚¨ï¼ˆchat-history-storageï¼‰

ä¸»æ–‡æ¡£ï¼š`docs/features/chat-history-storage/`

### Step 4: ai_chatbot DI + lifecycleï¼ˆå·²å®Œæˆï¼‰

**å®Œæˆæ—¶é—´**: 2026-01-07

**å®Œæˆå†…å®¹**:
- åœ¨ `products/ai_chatbot/dependencies.py` å¢åŠ  MessageStoreService çš„æ³¨å…¥ä¸è·å–ï¼ˆ`set_message_store()` / `get_message_store()`ï¼‰
- åœ¨ `products/ai_chatbot/lifespan.py` å¯åŠ¨æ—¶åˆå§‹åŒ–å¹¶å¯åŠ¨ `MessageStoreService` worker(s)ï¼Œå…³é—­æ—¶ä¼˜é›… shutdown

**æ¶‰åŠæ–‡ä»¶**:
| æ–‡ä»¶ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `products/ai_chatbot/dependencies.py` | ä¿®æ”¹ | æ³¨å…¥ MessageStoreService |
| `products/ai_chatbot/lifespan.py` | ä¿®æ”¹ | ç”Ÿå‘½å‘¨æœŸå¯åŠ¨/å…³é—­ MessageStoreService |

**æµ‹è¯•ç»“æœ**:
- âœ… DI + ç”Ÿå‘½å‘¨æœŸé›†æˆè‡ªæµ‹é€šè¿‡ï¼ˆMessageStoreService start/enqueue/shutdownï¼‰

---

### Step 5: Persist user/assistant messagesï¼ˆå·²å®Œæˆï¼‰

**å®Œæˆæ—¶é—´**: 2026-01-07

**å®Œæˆå†…å®¹**:
- åœ¨ `/chat` ä¸ `/chat/stream` ä¸¤ä¸ªå…¥å£ä¸­ï¼š
  - åœ¨è°ƒç”¨ Coze å‰ï¼Œbest-effort enqueue ä¿å­˜ `role=user` æ¶ˆæ¯ï¼ˆconversation_id å¯èƒ½ä¸ºç©ºï¼‰
  - åœ¨æœ€ç»ˆ AI å›å¤ç”Ÿæˆåï¼Œbest-effort enqueue ä¿å­˜ `role=assistant` æ¶ˆæ¯ï¼Œå¹¶è®°å½• `response_time_ms`

**æ¶‰åŠæ–‡ä»¶**:
| æ–‡ä»¶ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `products/ai_chatbot/handlers/chat.py` | ä¿®æ”¹ | å¢åŠ  enqueue ä¿å­˜ user/assistant æ¶ˆæ¯ |

**æµ‹è¯•ç»“æœ**:
- âœ… å•å…ƒçº§è‡ªæµ‹é€šè¿‡ï¼šé€šè¿‡ mock httpxï¼ˆæ— å¤–éƒ¨ç½‘ç»œï¼‰é©±åŠ¨ `/chat` ä¸ `/chat/stream` å®Œæ•´æ‰§è¡Œè·¯å¾„ï¼ŒéªŒè¯ enqueue å†™å…¥ `role=user` ä¸ `role=assistant` å‡è¢«è°ƒç”¨ï¼Œä¸” `assistant` è®°å½•äº† `response_time_ms` ä¸ `conversation_id`

---

## ä¸‰ã€æ€»ä½“è¿›åº¦

```
v7.7.0 æ€»è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 53%

Phase 1 (P0): [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% (8/8) âœ…
Phase 2 (P1): [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0% (0/4)
Phase 3 (P2): [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0% (0/3)
```

---

## å››ã€å·²å®Œæˆ Step è¯¦æƒ…

### Step 1.1: TrackingStatus æšä¸¾è‹±æ–‡åŒ–
- **çŠ¶æ€**: âœ… å·²å®Œæˆï¼ˆæšä¸¾å€¼æœ¬èº«å·²æ˜¯è‹±æ–‡ï¼‰
- **éªŒè¯**: `TrackingStatus.DELIVERED.value == "Delivered"`

### Step 1.2: API å“åº”é»˜è®¤è¿”å›è‹±æ–‡
- **æ”¹åŠ¨æ–‡ä»¶**:
  - `services/tracking/service.py`: ç¡¬ç¼–ç ä¸­æ–‡æ”¹ä¸ºè‹±æ–‡
  - `products/ai_chatbot/handlers/tracking.py`: æ·»åŠ  `_status_text_en()` å‡½æ•°ï¼Œmessage å­—æ®µæ”¹ä¸ºè‹±æ–‡
- **éªŒè¯**: `/api/tracking/{tracking_number}` è¿”å› `current_status_zh: "Tracking"`

### Step 1.3: å‰ç«¯ UI æ–‡æ¡ˆè‹±æ–‡åŒ–
- **æ”¹åŠ¨æ–‡ä»¶**:
  - `frontend/src/components/ChatMessage.vue`: é”™è¯¯æç¤ºã€æŒ‰é’®æ–‡æ¡ˆæ”¹ä¸ºè‹±æ–‡
  - `products/ai_chatbot/handlers/chat.py`: bot é»˜è®¤é…ç½®æ”¹ä¸ºè‹±æ–‡
  - `.env` / `.env.example`: Bot é…ç½®æ”¹ä¸ºè‹±æ–‡
- **éªŒè¯**: `/api/bot/info` è¿”å› `name: "Fiido Support"`

### Step 1.4: æç¤ºè¯è‹±æ–‡åŒ–
- **æ”¹åŠ¨æ–‡ä»¶**:
  - `prompts/è®¢å•æŸ¥è¯¢å›å¤_v2.md`: ç‰¹æ®Šåœºæ™¯æ·»åŠ è‹±æ–‡æ¨¡æ¿ï¼Œé¢„è®¡é€è¾¾æ—¶é—´æ·»åŠ è‹±æ–‡åˆ—
  - `prompts/order_query_reply_v2.md`: æ–°å¢å…¨è‹±æ–‡ç‰ˆæœ¬ï¼ˆç”¨äºç”Ÿäº§è¿ç§»ï¼‰
- **éªŒè¯**: AI å›å¤ç¬¦åˆè‹±æ–‡æ¨¡æ¿æ ¼å¼ï¼ŒPRODUCT æ ‡ç­¾æ­£ç¡®è§£æ

### Step 1.5: UserIntent æšä¸¾å®šä¹‰
- **æ”¹åŠ¨æ–‡ä»¶**:
  - `products/ai_chatbot/models.py`: æ–°å¢ UserIntent æšä¸¾ï¼ˆ5 ä¸ªå€¼ï¼‰
  - `ChatRequest` æ–°å¢ `intent` å’Œ `order_number` å­—æ®µ
- **æšä¸¾å€¼**: PRESALE, ORDER_STATUS, AFTER_SALE, CONTACT_AGENT, GENERAL
- **éªŒè¯**: Python å¯¼å…¥æµ‹è¯•é€šè¿‡

### Step 1.6: chat.py å¤„ç† intent å‚æ•°
- **æ”¹åŠ¨æ–‡ä»¶**:
  - `products/ai_chatbot/handlers/chat.py`: åŒæ­¥/æµå¼æ¥å£æ·»åŠ  INTENT å’Œ ORDER_NUMBER å‚æ•°ä¼ é€’
- **Coze å‚æ•°**:
  - `parameters.INTENT`: ç”¨æˆ·æ„å›¾ï¼ˆå¦‚ "order_status"ï¼‰
  - `parameters.ORDER_NUMBER`: è®¢å•å·ï¼ˆå”®åæµç¨‹ä½¿ç”¨ï¼‰
- **éªŒè¯**: curl æµ‹è¯•ï¼Œæ—¥å¿—æ˜¾ç¤º "ğŸ¯ Intent: order_status"

### Step 1.7: å”®åæµç¨‹çŠ¶æ€æœº
- **æ”¹åŠ¨æ–‡ä»¶**:
  - `frontend/src/stores/chatStore.ts`: æ·»åŠ  UserIntentã€AfterSaleState ç±»å‹å’ŒçŠ¶æ€ç®¡ç†æ–¹æ³•
  - `frontend/src/components/WelcomeScreen.vue`: å¿«æ·å›å¤æŒ‰é’®æ·»åŠ  intent å±æ€§
  - `frontend/src/components/ChatPanel.vue`: å®ç°å”®åçŠ¶æ€æœºé€»è¾‘ï¼Œè®¢å•å·éªŒè¯æµç¨‹
- **çŠ¶æ€æµç¨‹**:
  - idle â†’ awaiting_orderï¼ˆç‚¹å‡»å”®åæŒ‰é’®ï¼‰
  - awaiting_order â†’ validatingï¼ˆç”¨æˆ·è¾“å…¥è®¢å•å·ï¼‰
  - validating â†’ order_found/awaiting_orderï¼ˆéªŒè¯æˆåŠŸ/å¤±è´¥ï¼‰
  - order_found â†’ awaiting_issueï¼ˆç­‰å¾…ç”¨æˆ·æè¿°é—®é¢˜ï¼‰
- **éªŒè¯**: å‰ç«¯æ„å»ºæˆåŠŸ

### Step 1.8: UI ç´ ææ›¿æ¢
- **æ”¹åŠ¨æ–‡ä»¶**:
  - `frontend/public/icons/`: æ–°å¢ 4 ä¸ªå“ç‰Œ icon æ–‡ä»¶
    - `icon-order-status.png`: è®¢å•çŠ¶æ€å›¾æ ‡
    - `icon-product-help.png`: äº§å“å¸®åŠ©å›¾æ ‡
    - `icon-return.png`: é€€æ¢è´§å›¾æ ‡
    - `icon-contact-us.png`: è”ç³»å®¢æœå›¾æ ‡
  - `frontend/public/customer-service.jpg`: æ–°å¢å®¢æœå¤´åƒå›¾ç‰‡
  - `frontend/src/components/WelcomeScreen.vue`: å¿«æ·æŒ‰é’®æ”¹ç”¨ `<img>` æ ‡ç­¾ + BASE_URL
  - `frontend/src/components/ChatFloatButton.vue`: æ‚¬æµ®æŒ‰é’®å›¾æ ‡æ”¹ç”¨åŠ¨æ€è·¯å¾„
- **æŠ€æœ¯è¦ç‚¹**:
  - ä½¿ç”¨ `import.meta.env.BASE_URL` æ‹¼æ¥è·¯å¾„ä»¥é€‚é… vite çš„ base é…ç½®
- **éªŒè¯**: å‰ç«¯æ„å»ºæˆåŠŸï¼Œå›¾æ ‡æ­£ç¡®æ¸²æŸ“

---

## äº”ã€ä¸‹ä¸€æ­¥å·¥ä½œ

**å½“å‰ä»»åŠ¡**: Phase 1 å·²å®Œæˆï¼å‡†å¤‡è¿›å…¥ Phase 2

**ä¸‹ä¸€æ­¥**: Step 2.1 - æ·»åŠ  slowapi ä¾èµ–

---

## å…­ã€é˜»å¡é—®é¢˜

æš‚æ— é˜»å¡é—®é¢˜ã€‚

---

## ä¸ƒã€æ–‡æ¡£æ›´æ–°è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| v7.7.0-r6 | 2025-12-24 | è®°å½• Step 1.8 å®Œæˆï¼ŒPhase 1 100% å®Œæˆ |
| v7.7.0-r5 | 2025-12-24 | è®°å½• Step 1.7 å®Œæˆï¼Œè¿›åº¦ 87.5% |
| v7.7.0-r4 | 2025-12-24 | è®°å½• Step 1.5-1.6 å®Œæˆï¼Œè¿›åº¦ 75% |
| v7.7.0-r3 | 2025-12-24 | è®°å½• Step 1.4 å®Œæˆï¼Œæ›´æ–°è¿›åº¦è‡³ 50% |
| v7.7.0-r2 | 2025-12-24 | è®°å½• Step 1.1-1.3 å®Œæˆï¼Œæ›´æ–°è¿›åº¦ |
| v7.7.0 | 2025-12-24 | å…¨æ–°åˆ›å»ºï¼Œè®°å½• v7.6.x å·²å®ŒæˆåŠŸèƒ½ï¼Œè§„åˆ’ v7.7.0 ä»»åŠ¡ |
