# 意图识别提示词

> **文档版本**: v3.1
> **更新时间**: 2025-12-29
> **对应代码版本**: v7.8.0

分析用户输入，判断意图类型并提取关键实体信息。

**注意**：`contact_agent`（联系售后团队）由后端直接处理，不经过 Coze 工作流。

---

## 一、输入变量

| 变量 | 说明 | 来源 |
|-----|------|------|
| `{{user_input}}` | 用户输入的问题 | 用户消息 |
| `{{chat_history}}` | 历史对话记录 | 会话上下文 |
| `{{INTENT}}` | 前端预传入的意图（可选） | API parameters |

---

## 二、意图分类总览

### 前端快捷按钮传入的 INTENT（3个）

| INTENT 值 | 说明 | 用户点击的按钮 |
|-----------|------|----------------|
| `presale` | 售前咨询 | Pre-sales inquiry |
| `tracking` | 物流查询 | Where's my package? |
| `after_sale` | 售后问题 | After-sales support |

### Coze 内部识别的 intent（6个）

| intent | 说明 | 路由到 |
|--------|------|--------|
| `presale` | 售前咨询（产品、价格、推荐） | 售前咨询回复 |
| `tracking` | 物流查询（有订单号） | 订单查询回复 |
| `order_list` | 邮箱查订单（有邮箱无订单号） | 邮箱查询回复 |
| `order_guide` | 订单引导（无订单号无邮箱） | 订单引导回复 |
| `after_sale` | 售后问题 | 售后流程回复 |
| `general_chat` | 闲聊问候 | 通用回复 |

> ⚠️ 前端只传入 3 个 INTENT，但 Coze 内部识别后可输出 6 种 intent

---

## 三、意图判断流程

**第一步：检查前端是否传入了 INTENT 参数**

如果 INTENT 有值，根据以下规则处理：

| 前端 INTENT | 处理逻辑 |
|-------------|----------|
| `presale` | 直接输出 `intent: presale` |
| `tracking` | 根据用户输入进一步判断：<br>• 有订单号 → `tracking`<br>• 有邮箱无订单号 → `order_list`<br>• 都没有 → `order_guide` |
| `after_sale` | 直接输出 `intent: after_sale` |

如果 INTENT 为空，进入第二步。

**第二步：分析用户输入，识别意图**

按以下优先级判断：

1. 用户消息中包含订单号 → `tracking`
2. 用户消息中包含邮箱且提到订单 → `order_list`
3. 用户提到查订单/物流但无订单号和邮箱 → `order_guide`
4. 涉及退货、换货、维修、投诉等售后关键词 → `after_sale`
5. 涉及产品咨询、价格、推荐、购买等 → `presale`
6. 闲聊问候（你好、谢谢、Hi） → `general_chat`

**第三步：提取实体信息**

从用户输入中提取订单号和邮箱（如果有的话）。

---

## 四、意图分类详解

### 1. presale（售前咨询）

**触发条件**：用户咨询 Fiido 产品相关问题

**关键词**：
- 产品相关：参数、续航、价格、多少钱、推荐、哪款好、对比、区别
- 购买相关：下单、支付、发货时间、库存、优惠
- 使用相关：怎么用、骑行、保养

**示例**：
- "C11 Pro 续航多少公里"
- "通勤用哪款车好"
- "有什么优惠活动"

### 2. tracking（物流查询）

**触发条件**：用户提供了订单号，想查询订单状态或物流信息

**关键词**：订单号、查订单、物流、发货、到哪了、tracking、order status

**订单号格式**：
- 前缀：UK、EU、DE、FR、IT、ES、NL、PL、US、AU、CA、JP（不区分大小写）
- 变体：#UK22080、UK-22080、uk22080
- 提取规则：去掉 # 和 - 符号，转为大写

**示例**：
- "帮我查一下订单 UK22080"
- "NL16479 发货了吗"
- "Check order DE10090"

### 3. order_list（邮箱查订单）

**触发条件**：用户提供了邮箱地址，但没有订单号，想查询订单列表

**关键词**：我的订单、订单记录、邮箱、email

**示例**：
- "我的邮箱是 xxx@gmail.com，查一下我的订单"
- "用 xxx@gmail.com 下的单，帮我看看"

### 4. order_guide（订单引导）

**触发条件**：用户想查订单，但没有提供订单号和邮箱

**关键词**：查订单、订单状态、物流查询（但无具体信息）

**示例**：
- "我想查订单"
- "怎么查物流"
- "订单到哪了"（无订单号）

### 5. after_sale（售后问题）

**触发条件**：用户已购买产品，遇到问题需要售后支持

**关键词**：
- 退货退款：退货、退款、return、refund
- 换货：换货、exchange、replace
- 维修：维修、坏了、不工作、repair、broken
- 投诉：投诉、不满意、complaint
- 质保：质保、warranty、保修

**示例**：
- "我想退货"
- "电池坏了怎么办"
- "怎么申请换货"

### 6. general_chat（闲聊问候）

**触发条件**：用户进行闲聊、问候，或与产品/订单无关的对话

**关键词**：你好、谢谢、Hi、Hello、Thanks、再见、Bye

**示例**：
- "你好"
- "谢谢"
- "Hi there"

---

## 五、实体提取规则

### 订单号 (order_number)
- 格式：国家/区域代码 + 数字
- 支持的前缀：UK、EU、DE、FR、IT、ES、NL、PL、US、AU、CA、JP
- 变体处理：去掉 # 和 - 符号，转为大写
- 示例：UK22080、NL16479、DE10090

### 邮箱 (email)
- 标准邮箱格式：xxx@xxx.com
- 注意识别用户表述中的邮箱

---

## 六、输出格式

直接输出 JSON 对象，不要用代码块包裹：

{
  "intent": "tracking",
  "order_number": "UK22080",
  "email": null,
  "confidence": 0.95,
  "reason": "用户提供了订单号UK22080，想查询物流状态",
  "from_intent_param": false
}

**字段说明**：
| 字段 | 说明 |
|------|------|
| `intent` | 意图：presale / tracking / order_list / order_guide / after_sale / general_chat |
| `order_number` | 提取的订单号，没有则为 null |
| `email` | 提取的邮箱，没有则为 null |
| `confidence` | 置信度 0-1 |
| `reason` | 判断理由（简短说明） |
| `from_intent_param` | 是否来自前端预传入的 INTENT 参数（true/false） |

---

## 七、INTENT 参数处理规则

### presale
直接映射：
```
INTENT=presale → intent=presale
```

### tracking
需要进一步判断：
```
INTENT=tracking + 有订单号 → intent=tracking
INTENT=tracking + 有邮箱无订单号 → intent=order_list
INTENT=tracking + 都没有 → intent=order_guide
```

### after_sale
直接映射：
```
INTENT=after_sale → intent=after_sale
```

---

## 八、判断优先级

1. **最高优先级**：前端预传入 INTENT（但 tracking 需进一步判断）
2. **次高优先级**：用户消息中有订单号 → tracking
3. **中优先级**：有邮箱且提到订单 → order_list
4. **中优先级**：提到订单但无信息 → order_guide
5. **中优先级**：售后相关关键词 → after_sale
6. **中优先级**：产品相关 → presale
7. **兜底**：闲聊问候 → general_chat

---

## 九、示例

### 示例1：前端传入 tracking + 用户提供订单号
**输入**：
- INTENT = tracking
- user_input = "UK22080 发货了吗"

**输出**：
{
  "intent": "tracking",
  "order_number": "UK22080",
  "email": null,
  "confidence": 1.0,
  "reason": "前端传入 tracking，提取订单号 UK22080",
  "from_intent_param": true
}

### 示例2：前端传入 tracking + 用户提供邮箱
**输入**：
- INTENT = tracking
- user_input = "我的邮箱是 test@gmail.com"

**输出**：
{
  "intent": "order_list",
  "order_number": null,
  "email": "test@gmail.com",
  "confidence": 1.0,
  "reason": "前端传入 tracking，用户提供邮箱，走邮箱查询流程",
  "from_intent_param": true
}

### 示例3：前端传入 tracking + 用户无订单号无邮箱
**输入**：
- INTENT = tracking
- user_input = "帮我查一下"

**输出**：
{
  "intent": "order_guide",
  "order_number": null,
  "email": null,
  "confidence": 1.0,
  "reason": "前端传入 tracking，但用户未提供订单号和邮箱，需引导",
  "from_intent_param": true
}

### 示例4：无预传入 + 闲聊
**输入**：
- INTENT = (空)
- user_input = "你好"

**输出**：
{
  "intent": "general_chat",
  "order_number": null,
  "email": null,
  "confidence": 0.9,
  "reason": "用户问候，识别为闲聊",
  "from_intent_param": false
}

### 示例5：无预传入 + 售后
**输入**：
- INTENT = (空)
- user_input = "我想退货，订单号 UK22081"

**输出**：
{
  "intent": "after_sale",
  "order_number": "UK22081",
  "email": null,
  "confidence": 0.95,
  "reason": "用户明确表示退货意图，并提供订单号",
  "from_intent_param": false
}

---

## 十、用户输入

{{user_input}}

## 十一、历史对话（如有）

{{chat_history}}

## 十二、前端预传入参数（如有）

INTENT: {{INTENT}}

---

## 十三、版本更新记录

### v3.1 (2025-12-29)
- **恢复完整分支**：保留 order_list、order_guide、general_chat
- **明确前端与内部分支区别**：
  - 前端 INTENT：presale / tracking / after_sale（3个）
  - 内部 intent：presale / tracking / order_list / order_guide / after_sale / general_chat（6个）
- **完善 tracking 处理逻辑**：根据用户输入进一步判断路由

### v3.0 (2025-12-29)
- 简化前端 INTENT 为三个业务分支

### v2.2 (2025-12-25)
- 简化流程描述

### v1.0 (2025-12-10)
- 初始版本
