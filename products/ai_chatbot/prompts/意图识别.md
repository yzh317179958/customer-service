# 意图识别提示词

> **文档版本**: v2.2
> **更新时间**: 2025-12-25
> **对应代码版本**: v7.7.0

分析用户输入，判断意图类型并提取关键实体信息。支持前端预传入 INTENT 参数的场景。

**注意**：`contact_agent`（转人工）意图由后端直接处理，不经过 Coze 工作流。

---

## 一、输入变量

| 变量 | 说明 | 来源 |
|-----|------|------|
| `{{user_input}}` | 用户输入的问题 | 用户消息 |
| `{{chat_history}}` | 历史对话记录 | 会话上下文 |
| `{{INTENT}}` | 前端预传入的意图（可选） | API parameters |

---

## 二、意图判断流程

**第一步：检查前端是否传入了 INTENT 参数**

如果 INTENT 参数有值（不为空），则直接使用该意图，跳过自然语言识别，但仍需从用户输入中提取订单号、邮箱等实体信息。

如果 INTENT 参数为空，则进入第二步，分析用户输入内容进行意图识别。

**第二步：分析用户输入，识别意图**

按以下优先级判断：
1. 如果用户消息中包含订单号（如 UK22080），判定为 order_query
2. 如果用户消息中包含邮箱且提到订单相关，判定为 order_list
3. 如果用户提到查订单、物流但没有具体信息，判定为 order_guide
4. 如果涉及退货、换货、维修、投诉等售后关键词，判定为 after_sale
5. 如果涉及产品咨询、价格、推荐等，判定为 product_consult
6. 其他情况判定为 general_chat

**第三步：提取实体信息**

从用户输入中提取订单号和邮箱（如果有的话）。

**第四步：输出识别结果**

### INTENT 参数映射

当前端传入 INTENT 时，直接映射到对应意图：

| INTENT 值 | 映射意图 | 说明 |
|-----------|----------|------|
| `presale` | product_consult | 售前咨询（产品相关） |
| `order_status` | order_query / order_guide | 订单查询（有订单号→order_query，无→order_guide） |
| `after_sale` | after_sale | 售后服务 |
| `general` | general_chat | 通用对话 |

> ⚠️ `contact_agent` 不在此处理，由后端拦截直接转人工

---

## 三、意图分类

### 1. order_query（订单查询）
**触发条件**：用户提供了订单号，想查询订单状态或物流信息
**关键词**：订单号、查订单、物流、发货、到哪了、tracking、order status
**示例**：
- "帮我查一下订单 UK22080"
- "UK22080 发货了吗"
- "我的订单 #UK22080 物流到哪了"
- "Check order UK22080"

### 2. order_list（订单列表查询）
**触发条件**：用户提供了邮箱地址，但没有订单号，想查询自己的订单
**关键词**：我的订单、订单记录、邮箱、email
**示例**：
- "我的邮箱是 xxx@gmail.com，查一下我的订单"
- "用 xxx@gmail.com 下的单，帮我看看"
- "查询邮箱 xxx@gmail.com 的订单"

### 3. order_guide（订单引导）
**触发条件**：用户想查订单，但没有提供订单号和邮箱
**关键词**：查订单、订单状态、物流查询（但无具体信息）
**示例**：
- "我想查订单"
- "怎么查物流"
- "订单到哪了"（无订单号）

### 4. product_consult（产品咨询/售前）
**触发条件**：用户咨询 Fiido 产品相关问题
**对应 INTENT**：`presale`
**子类型**：
- **product_info**：产品参数、功能、性能
- **product_compare**：产品对比、推荐
- **product_price**：价格、促销、优惠
- **product_purchase**：购买、下单、支付
- **product_usage**：使用方法、骑行问题
**示例**：
- "C11 Pro 续航多少公里"
- "通勤用哪款车好"
- "有什么优惠活动"

### 5. after_sale（售后服务）
**触发条件**：用户已购买产品，遇到问题需要售后支持
**对应 INTENT**：`after_sale`
**子类型**：
- **return_refund**：退货退款
- **exchange**：换货
- **repair**：维修
- **complaint**：投诉
- **warranty**：质保咨询
**示例**：
- "我想退货"
- "电池坏了怎么办"
- "我要投诉"
- "怎么申请换货"

### 6. general_chat（闲聊问候）
**触发条件**：用户进行闲聊、问候，或与产品/订单无关的对话
**对应 INTENT**：`general`
**示例**：
- "你好"
- "谢谢"
- "今天天气怎么样"

---

## 四、实体提取规则

### 订单号 (order_number)
- 格式：UK/EU/DE/FR/IT/ES/NL/PL/US + 数字（如 UK22080、DE10090）
- 变体：#UK22080、UK-22080、uk22080
- 提取时统一去掉 # 和 - 符号，转为大写，保留前缀 + 数字

### 邮箱 (email)
- 标准邮箱格式：xxx@xxx.com
- 注意识别用户表述中的邮箱

---

## 五、输出格式

直接输出 JSON 对象，不要用代码块包裹：

{
  "intent": "order_query",
  "sub_intent": null,
  "order_number": "UK22080",
  "email": null,
  "confidence": 0.95,
  "reason": "用户提供了订单号UK22080，想查询订单状态",
  "from_intent_param": false
}

**字段说明**：
| 字段 | 说明 |
|------|------|
| `intent` | 主意图：order_query / order_list / order_guide / product_consult / after_sale / general_chat |
| `sub_intent` | 子意图（仅 product_consult 和 after_sale 有，其他为 null） |
| `order_number` | 提取的订单号，没有则为 null |
| `email` | 提取的邮箱，没有则为 null |
| `confidence` | 置信度 0-1 |
| `reason` | 判断理由（简短说明） |
| `from_intent_param` | 是否来自前端预传入的 INTENT 参数（true/false） |

---

## 六、判断优先级

1. **最高优先级**：前端预传入 INTENT，直接使用
2. **次高优先级**：用户消息中有订单号 → order_query
3. **中优先级**：有邮箱且提到订单 → order_list
4. **中优先级**：提到订单但无信息 → order_guide
5. **中优先级**：售后相关关键词 → after_sale
6. **默认**：产品相关 → product_consult
7. **兜底**：其他 → general_chat

---

## 七、特殊情况处理

### 1. 前端预传入 INTENT
- 如果 INTENT 有值，设置 from_intent_param 为 true
- 直接使用映射关系，不再分析用户输入中的意图
- 但仍需提取用户输入中的订单号、邮箱等实体

### 2. 同时有订单号和邮箱
- 优先 order_query（订单号更精确）

### 3. 历史对话上下文
- 结合历史对话判断
- 如果用户之前提供过订单号/邮箱，当前对话提到"那个订单"应关联之前的信息

### 4. 模糊表述
- 如"帮我查查"需要结合上下文判断是查订单还是查产品信息

### 5. 用户要求转人工
- 如果用户在对话中说"转人工"、"找客服"等
- 输出 general_chat 意图，让后端根据关键词检测处理

---

## 八、示例

### 示例1：前端预传入售后意图
**输入**：
- INTENT = after_sale
- user_input = "我的电池有问题"

**输出**：
{
  "intent": "after_sale",
  "sub_intent": "repair",
  "order_number": null,
  "email": null,
  "confidence": 1.0,
  "reason": "前端预传入 after_sale 意图，用户描述电池问题",
  "from_intent_param": true
}

### 示例2：前端预传入订单状态意图 + 用户提供订单号
**输入**：
- INTENT = order_status
- user_input = "UK22080 发货了吗"

**输出**：
{
  "intent": "order_query",
  "sub_intent": null,
  "order_number": "UK22080",
  "email": null,
  "confidence": 1.0,
  "reason": "前端预传入 order_status 意图，从用户消息提取订单号 UK22080",
  "from_intent_param": true
}

### 示例3：无预传入，自然语言识别
**输入**：
- INTENT = (空)
- user_input = "我想退货，订单号 UK22081"

**输出**：
{
  "intent": "after_sale",
  "sub_intent": "return_refund",
  "order_number": "UK22081",
  "email": null,
  "confidence": 0.95,
  "reason": "用户明确表示退货意图，并提供订单号",
  "from_intent_param": false
}

### 示例4：用户要求转人工
**输入**：
- INTENT = (空)
- user_input = "我要转人工"

**输出**：
{
  "intent": "general_chat",
  "sub_intent": null,
  "order_number": null,
  "email": null,
  "confidence": 0.9,
  "reason": "用户要求转人工，交由后端处理",
  "from_intent_param": false
}

### 示例5：用户直接输入订单号
**输入**：
- INTENT = order_status
- user_input = "UK22103"

**输出**：
{
  "intent": "order_query",
  "sub_intent": null,
  "order_number": "UK22103",
  "email": null,
  "confidence": 1.0,
  "reason": "前端预传入 order_status，用户输入订单号 UK22103",
  "from_intent_param": true
}

---

## 九、用户输入

{{user_input}}

## 十、历史对话（如有）

{{chat_history}}

## 十一、前端预传入参数（如有）

INTENT: {{INTENT}}

---

## 十二、版本更新记录

### v2.2 (2025-12-25)
- **简化流程描述**：用自然语言替代流程图
- **修改输出格式**：JSON 不再用代码块包裹
- **移除 ORDER_NUMBER 参数**：订单号统一从用户消息中提取
- **新增示例5**：用户直接输入订单号的场景

### v2.1 (2025-12-25)
- **移除 contact_agent 意图**：转人工逻辑由后端直接处理，不经过 Coze
- 意图从 7 种减少为 6 种

### v2.0 (2025-12-25)
- **新增 INTENT 参数支持**：支持前端预传入意图，跳过意图识别直接路由
- **新增 after_sale 意图**：独立售后服务意图，包含退换货、维修、投诉等子类型

### v1.0 (2025-12-10)
- 初始版本
