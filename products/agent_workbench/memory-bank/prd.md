# 坐席工作台（Agent Workbench）- 产品需求文档 (PRD)

> **产品名称**：Fiido 智能坐席工作台（Agent Workbench）
> **范围**：工作台前端 + 工作台后端 API（已存在能力的接入与补齐）
> **版本**：v1.0
> **创建日期**：2025-12-19
> **状态**：前端待开发（复用 `products/agent_workbench/fronted_origin` 原型）

---

## 1. 产品概述

### 1.1 目标用户

- **一线坐席**：处理用户转人工后的对话，创建/跟进工单
- **主管/管理员**：坐席管理、工单分配与 SLA 监控、数据报表与审计

### 1.2 核心价值

- **AI + 人工协同**：AI 无法解决时无缝转人工，提升问题闭环率
- **效率与标准化**：快捷回复、模板、工单流程与协作能力，提高处理效率
- **可追溯与可运营**：SLA、审计日志、统计报表，让服务可度量可优化

### 1.3 系统边界（与其他产品的关系）

- 本工作台属于 `products/agent_workbench` 产品层，对外提供坐席侧 API（`/api/*`）。
- 用户端对话与人工消息写入当前主要在 `products/ai_chatbot`（如 `/api/manual/messages`）中实现；工作台前端可能需要调用 **多个产品 API**，但后端代码层面遵守 **products 之间禁止互相 import** 的铁律（通过 services/ 或 HTTP API 协作）。

---

## 2. 现状盘点（已实现 vs 待补齐）

### 2.1 已实现的后端能力（可直接接入前端）

`products/agent_workbench` 已提供较完整 API（按模块）：

- **坐席认证与状态**：`/api/agent/*`（登录、刷新、个人信息、在线状态、心跳、当日统计等）
- **会话管理**：`/api/sessions/*`（队列、统计、详情、接管/释放/转接、从会话创建工单等）
- **工单系统**：`/api/tickets/*`（列表/搜索/筛选、指派、批量操作、评论、附件、审计日志、SLA 仪表盘与告警等）
- **快捷回复**：`/api/quick-replies/*`
- **模板管理**：`/api/templates/*`（工单模板、渲染）
- **坐席管理（Admin）**：`/api/agents/*`
- **协助请求**：`/api/assist-requests/*`
- **Shopify 查询**：`/api/shopify/*`（多站点订单、搜索、物流、健康检查等）
- **缓存预热**：`/api/warmup/*`
- **CDN 健康检查**：`/api/cdn/*`
- **杂项与协作**：`/api/admin/sessions/clear`、客户档案、转接请求处理、内部备注 CRUD、转接历史、坐席事件 SSE（`/api/agent/events`）

### 2.2 已有可复用的前端原型

- `products/agent_workbench/fronted_origin`：包含侧边栏、顶部栏、会话工作台、工单中心、报表/监控/质检/知识库/计费/设置等页面原型（当前为静态数据与 AI Studio 风格工程，需要工程化改造）。

### 2.3 关键缺口（需要补齐才能“完整可用”）

**A. 后端缺口（建议补齐）**

- **坐席发送消息的安全入口**：当前人工消息写入在 `products/ai_chatbot` 的 `/api/manual/messages`，未绑定坐席 JWT；建议在 `products/agent_workbench` 提供受 `require_agent()` 保护的“发送消息/写入人工消息”端点（并复用 `services/session` 存储与 SSE 队列）。
- **会话实时事件流（Session SSE）**：目前 `products/agent_workbench` 仅有坐席事件 SSE（@提醒/协助等）。为实现聊天实时刷新，建议新增 `GET /api/sessions/{session_name}/events`（或等价）以从 session 维度推送 `manual_message/status_change` 等事件。
- **聚合报表接口（可选）**：Dashboard/Monitoring 若不想前端拼接多接口，可新增 `/api/metrics/overview` 之类聚合接口（P1）。

**B. 前端缺口（原型未覆盖但后端已具备）**

- 快捷回复管理与会话内快捷回复面板（对接 `/api/quick-replies/*`）
- 工单模板管理（对接 `/api/templates/*`）
- 协助请求流转 UI（对接 `/api/assist-requests/*` + `/api/agent/events`）
- 坐席管理后台（对接 `/api/agents/*`）
- 工单评论/附件/审计日志、SLA 仪表盘/告警 UI（对接 `/api/tickets/*`）
- 缓存预热与 CDN 健康检查 UI（对接 `/api/warmup/*`、`/api/cdn/*`）

**C. 原型存在但后端缺失（建议作为 P1/P2）**

- 知识库管理与搜索（原型有 `KnowledgeBase`，建议新建 `services/knowledge_base` + `products/knowledge_base` 或在 agent_workbench 内以服务形式落地）
- 智能质检与绩效（原型有 `QualityAudit`，现阶段可先展示工单审计/统计；会话级质检建议单独服务化）

---

## 3. 功能范围

### 3.1 核心功能（P0 - 必须实现）


| 模块               | 功能                                                       | 验收标准                                           |
| ------------------ | ---------------------------------------------------------- | -------------------------------------------------- |
| 登录与鉴权         | 坐席登录/退出、刷新 token、角色识别（admin/agent）         | 401/403 行为正确；刷新可用；敏感页需登录           |
| 会话队列与接管     | 会话列表/状态筛选、查看详情、接管/释放、转接               | 关键动作成功后列表与详情一致；冲突状态返回可读错误 |
| 人工消息发送       | 会话内发送消息、消息入库、用户端可见                       | 发送后消息出现在会话历史；SSE/刷新后用户端可见     |
| 客户档案与订单信息 | 客户基础信息、关联订单查询、物流状态                       | 可按 email/订单号拉取订单；展示关键字段            |
| 工单中心           | 列表/筛选/搜索、创建工单、指派、状态流转、SLA 视图（基础） | 工单 CRUD 可用；SLA summary/alerts 可展示          |
| 协作与备注         | 内部备注（含 @提醒）、协助请求创建/处理                    | @提醒可通过坐席事件 SSE 到达；记录可追溯           |

### 3.2 重要功能（P1 - 应该实现）

- 快捷回复（分类/搜索/快捷键/变量替换）与使用统计
- 工单模板管理与渲染（减少手工录入）
- 监控页：缓存预热、CDN 健康检查、SLA 告警聚合
- 仪表盘：会话/工单关键指标与趋势（可先前端聚合）

### 3.3 扩展功能（P2 - 后续迭代）

- 知识库（文档上传、分类、全文检索、推荐、引用）
- 智能质检（会话抽检、违规识别、质检评分、整改流转）
- 多语言实时翻译、全渠道接入（电话/邮件/IM）
- 计费门户：通过 iframe 嵌入 `products/customer_portal`（与原型 `BillingView` 设计一致）

---

## 4. 关键用户故事（示例）

1. 作为坐席，我能看到“等待人工”的会话队列，并一键接管开始服务。
2. 作为坐席，我在会话中发送的人工消息会被记录，用户端实时可见。
3. 作为坐席，我能将复杂问题一键创建工单，并上传附件/添加备注推进闭环。
4. 作为主管，我能看到 SLA 告警与队列健康度，及时调度坐席资源。
5. 作为管理员，我能管理坐席账号与技能，控制可接待上限与角色权限。

---

## 5. 成功标准

- **可用性**：坐席可完成“登录 → 接管 → 沟通 → 创建/更新工单 → 释放/转接”的完整闭环
- **一致性**：会话状态与工单状态在列表/详情/报表中一致，且可追溯
- **性能**：会话列表刷新 < 2s；关键操作接口 < 500ms（本地/内网环境）
- **安全**：坐席侧写操作必须通过 JWT 认证；管理员能力需 403 防护

---

## 6. 参考资料（详细需求拆解）

- `CLAUDE.md`（最高开发规范，三层架构与 Vibe Coding 工作流）
- `Vibe_Coding开发规范流程说明.md`（memory-bank 文档与实施节奏）
- 任务拆解（更细粒度需求）：`docs/prd/04_任务拆解/`（L1-L4 系列文档）
- 前端原型：`products/agent_workbench/fronted_origin`
