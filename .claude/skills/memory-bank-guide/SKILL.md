---
name: memory-bank-guide
description: 创建或更新 memory-bank 文档。支持两种场景：1）新建模块时生成完整文档；2）已有模块新增需求时迭代更新文档。当用户说"创建新产品"、"生成 memory-bank 文档"、"初始化新模块"、"新增需求"、"扩展功能"、"添加新功能"、"更新 PRD"时自动激活
---
# Memory-Bank 文档生成指南

> 遵循 `CLAUDE.md` 最高开发规范 + `Vibe_Coding开发规范流程说明.md` 方法论

## 核心原则

> **"规划就是一切。不要让 AI 自主规划，否则你的代码库会变成一团乱麻。"**

**必须遵守的铁律（来自 CLAUDE.md）：**

- 三层架构：`products/` → `services/` → `infrastructure/`
- 单向依赖：上层可依赖下层，下层不可依赖上层，产品间禁止互相依赖
- 自底向上开发：先 infrastructure → 再 services → 最后 products
- 文档驱动：每个产品模块必须包含 `memory-bank/` 文件夹

---

## 何时使用

### 场景一：新建模块（从零开始）

- 用户说"创建新产品/服务"
- 用户说"生成 memory-bank 文档"
- 用户说"初始化新模块"

### 场景二：迭代更新（已有模块新增需求）

- 用户说"新增需求"、"扩展功能"
- 用户说"添加新功能"
- 用户说"更新 PRD"
- 用户说"继续开发 Phase 2"

---

## 判断场景的逻辑

**在执行任何操作前，先检查目标模块是否已有 memory-bank/ 文件夹：**

```
1. 检查 {module}/memory-bank/ 是否存在
   ├── 不存在 → 场景一：新建模块，执行完整生成流程
   └── 已存在 → 场景二：迭代更新，执行增量更新流程
```

---

## 五个必备文件

```
memory-bank/
├── prd.md                 # 产品需求文档（为什么做、做什么）
├── tech-stack.md          # 技术栈说明（用什么技术）
├── implementation-plan.md # 分步实现计划（怎么做，分几步）
├── progress.md            # 进度追踪（做到哪了）
└── architecture.md        # 架构说明（结构是什么样）
```

---

## 第一步：询问用户产品需求（必做）

**在生成任何文档之前，必须先向用户询问：**

```
在生成 memory-bank 文档之前，请告诉我：

**你要开发什么产品/功能？**

请用口语化的方式描述：
- 这是什么？解决什么问题？
- 目标用户是谁？
- 核心功能有哪些？
- 有什么技术偏好或限制？

我会根据你的描述，生成完整的 memory-bank 文档。
```

---

## 第二步：生成产品需求文档 (prd.md)

**文件名：** `memory-bank/prd.md`

**生成提示词（内部使用，将 [产品/功能描述] 替换为用户描述）：**

```
我要开发一个 [产品/功能描述]。

请帮我生成一个简洁的产品需求文档 (PRD)，包含以下部分：

1. 产品概述
   - 产品名称
   - 目标用户
   - 核心价值

2. 功能列表
   - 核心功能（必须实现）
   - 扩展功能（后续迭代）

3. 用户故事
   - 列出 3-5 个主要用户场景

4. 成功标准
   - 如何判断功能开发成功

要求：
- 保持简洁，不要过度设计
- 使用 Markdown 格式
- 先聚焦核心功能，细节后续迭代
```

**输出格式：**

```markdown
# [产品名] PRD

## 1. 产品概述

### 产品名称
[产品名称]

### 目标用户
- [用户1]
- [用户2]

### 核心价值
[核心价值描述]

## 2. 功能列表

### 核心功能（P0）
- [ ] [功能1]
- [ ] [功能2]

### 扩展功能（P1）
- [ ] [功能1]

## 3. 用户故事

1. 作为[用户]，我希望[做什么]
2. ...

## 4. 成功标准

- [标准1]
- [标准2]
```

---

## 第三步：生成技术栈文档 (tech-stack.md)

**文件名：** `memory-bank/tech-stack.md`

**生成提示词（内部使用）：**

```
我正在开发 [产品描述]，请为我推荐最合适的技术栈。

当前项目已有技术栈（Fiido 智能服务平台）：
- 后端: Python/FastAPI
- 前端: React/Vue + TypeScript + Tailwind CSS
- 数据库: Redis
- 三层架构: products/ → services/ → infrastructure/

请基于现有技术栈，为新功能推荐：
1. 符合生产环境和企业级实际使用要求的健壮实现方案
2. 需要的新依赖（如果有）
3. 数据存储方案
4. API 设计建议

要求：
- 优先复用现有技术栈和 services/ 服务
- 避免引入不必要的新依赖
- 遵循三层架构依赖规则
- 保持方案简洁但健壮，满足生产环境稳定性要求
- 考虑企业级场景：高并发、容错、可维护性、安全性
```

**输出格式：**

```markdown
# [产品名] - 技术栈

## 复用现有技术栈

| 层级 | 技术 | 说明 |
|------|------|------|
| 产品层 | FastAPI | products/xxx |
| 服务层 | services/session, services/ticket... | 已有服务 |
| 基础设施层 | infrastructure/bootstrap, infrastructure/security | 组件工厂、认证 |
| 前端 | React + TypeScript + Tailwind CSS | 已有框架 |
| 数据存储 | Redis | 已有 |

## 新增依赖

无需新增依赖 / [依赖列表及原因]

## 数据存储方案

[Redis 数据结构示例]

## API 设计

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/xxx | [说明] |
| GET | /api/xxx | [说明] |
```

---

## 第四步：生成实现计划 (implementation-plan.md)

**文件名：** `memory-bank/implementation-plan.md`

**生成提示词（内部使用）：**

```

请阅读并根据以下文档生成详细的实现计划：

【PRD 文档】@prd.md

【技术栈文档】@tech-stack.md

【最高约束性文档】@claude.md

请生成 implementation-plan.md，要求：

1. 遵循自底向上开发顺序：infrastructure/ → services/ → products/ → 前端
2. 每个步骤要小且具体（单个 API 或单个组件）
3. 每个步骤必须包含验证测试
4. 只写指令，不写具体代码
5. 先实现核心功能，扩展功能放后面
6. 步骤之间有明确的依赖关系

格式要求：
## Step N: 步骤标题
- 任务描述（做什么）
- 涉及文件（改哪里）
- 测试方法（如何验证）
- 预期结果（通过标准）
```

**输出格式：**

```markdown
# [产品名] - 实现计划

> 预计步骤数: N
> 核心功能步骤: Step 1-X
> 扩展功能步骤: Step X-N

---

## 开发顺序说明

遵循 `CLAUDE.md` 自底向上原则：

```

infrastructure/ → services/ → products/ → 前端 → 测试

```

---

## Step 1: [步骤标题]

**任务描述：**
[做什么]

**涉及文件：**
- `path/file.py`（新增/修改）

**测试方法：**
```bash
[测试命令]
```

**预期结果：**

- [验收标准1]
- [验收标准2]

---

## Step 2: [步骤标题]

[同上结构]

```

---

## 第五步：创建空白追踪文件

### progress.md

```markdown
# 开发进度追踪

> 功能: [功能名称]
> 开始日期: YYYY-MM-DD
> 当前步骤: Step 1

---

## 完成记录

（每完成一步在此记录）
```

### architecture.md

```markdown
# 架构说明

> 功能: [功能名称]
> 最后更新: YYYY-MM-DD
> 遵循规范: CLAUDE.md 三层架构

---

## 文件结构

（每新增文件在此说明用途）

## 数据流

（说明数据如何流转）

## 关键设计决策

（记录重要的设计选择及原因）
```

---

## 完成后的检查清单

- [ ]  已询问用户产品需求描述
- [ ]  创建 `memory-bank/` 文件夹
- [ ]  生成 `prd.md`
- [ ]  生成 `tech-stack.md`
- [ ]  生成 `implementation-plan.md`
- [ ]  创建空白 `progress.md`
- [ ]  创建空白 `architecture.md`
- [ ]  让 AI 确认计划清晰

---

## 后续：开始开发

文档生成完成后，告知用户：

```
memory-bank 文档已生成完成！

接下来你可以说：
- "开始 Step 1" 或 "继续开发" - 执行开发步骤

我会按照 vibe-coding-workflow 流程：
1. 阅读所有文档
2. 执行当前步骤
3. 等待你测试验证
4. 更新 progress.md 和 architecture.md
5. Git commit
6. 继续下一步
```

---

## 创建新模块后的后续步骤（来自 CLAUDE.md）

1. **更新 PROJECT_OVERVIEW.md**（产品/服务清单）
2. **更新 .env 配置**（如需要环境变量）
3. **开始按 implementation-plan.md 执行**

---

## 场景二：迭代更新流程（已有模块新增需求）

> **核心原则：在现有文档基础上追加，不要清空重建**

### 第一步：阅读现有文档

**必须先阅读 memory-bank/ 中的所有文档，了解：**

- 当前已完成的功能（progress.md）
- 现有架构设计（architecture.md）
- 技术栈选型（tech-stack.md）
- 已有需求（prd.md）

### 第二步：询问用户新需求

```
我已阅读现有的 memory-bank 文档。

当前模块状态：
- 已完成 Phase 1，共 N 个步骤
- 核心功能：[列出已完成功能]

请描述你要新增的功能/需求：
- 这个新功能是什么？
- 与现有功能的关系？
- 有什么技术约束？
```

### 第三步：增量更新 prd.md

**在文件开头插入新版本章节：**

```markdown
## v2.0 新增需求（YYYY-MM-DD）

### 背景
基于 v1.0 已上线功能，[新需求背景]

### 新增功能（P0）
- [ ] [新功能1]
- [ ] [新功能2]

### 新增功能（P1）
- [ ] [新功能3]

### 成功标准
- [ ] [新标准]

---

## v1.0 需求（已完成）
[保留原有内容不变]
```

### 第四步：增量更新 tech-stack.md

**如需新技术，在文件开头追加：**

```markdown
## 新增依赖（v2.0 - YYYY-MM-DD）

| 依赖 | 用途 | 原因 |
|------|------|------|
| [新依赖] | [用途] | [为什么需要] |

---

## 原有技术栈（v1.0）
[保留原有内容不变]
```

### 第五步：增量更新 implementation-plan.md

**在文件开头插入新阶段：**

```markdown
## Phase 2: [新功能名称]（YYYY-MM-DD）

> 前置条件：Phase 1 已完成
> 预计步骤：Step N+1 ~ Step M

### Step N+1: [步骤标题]

**任务描述：**
[做什么]

**涉及文件：**
- `path/file.py`（新增/修改）

**测试方法：**
```bash
[测试命令]
```

**预期结果：**

- [验收标准]

---

## Phase 1: 初始开发（已完成）

[保留原有内容不变]

```

### 第六步：通知用户

```

memory-bank 文档已更新完成！

新增内容：

- prd.md: 添加了 v2.0 需求章节
- tech-stack.md: [如有新依赖则说明]
- implementation-plan.md: 添加了 Phase 2，共 N 个新步骤

接下来你可以说：

- "开始 Step N+1" - 执行新功能开发
- "继续开发" - 从 Phase 2 第一步开始

我会继续按照 vibe-coding-workflow 流程执行。

```

---

## 迭代更新的检查清单

- [ ] 已阅读现有 memory-bank 所有文档
- [ ] 已询问用户新需求描述
- [ ] 已在 prd.md 开头追加新版本章节
- [ ] 已在 tech-stack.md 追加新依赖（如有）
- [ ] 已在 implementation-plan.md 追加新 Phase
- [ ] 保留了所有历史内容
- [ ] 通知用户可以继续开发
```
