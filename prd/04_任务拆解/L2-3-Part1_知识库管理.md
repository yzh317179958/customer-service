# L2-3-Part1: 知识库管理系统

> **文档编号**: L2-3-Part1
> **文档版本**: v1.0
> **优先级**: P1（增强层 - 重要）
> **状态**: ❌ 待开发
> **创建时间**: 2025-01-27
> **最后更新**: 2025-01-27

---

## 📑 文档导航

- **上级文档**: [ENTERPRISE_EBIKE_SUPPORT_TASKS.md](./ENTERPRISE_EBIKE_SUPPORT_TASKS.md)
- **同级文档**:
  - 上一篇: L2-2-Part2 客户分析与生命周期
  - 当前: L2-3-Part1 知识库管理
  - 下一篇: L2-3-Part2 知识搜索与统计
- **依赖关系**: 无前置依赖，独立模块

---

## 🎯 Part 1 概述

### 涵盖模块

本文档包含知识库系统的基础管理功能：

| 模块编号 | 模块名称 | 核心功能 |
|---------|---------|---------|
| **模块1** | 知识分类体系 | 分类管理、层级结构、标签系统 |
| **模块2** | 知识内容管理 | 创建、编辑、版本控制、富文本 |
| **模块3** | 权限与审核 | 角色权限、审核流程、发布控制 |

### 业务价值

**当前痛点**（v3.x.x）：
- ❌ 无知识库系统：坐席依赖个人经验和笔记
- ❌ 知识分散：产品信息、常见问题散落在不同文档
- ❌ 更新困难：产品信息变更后，需要逐个通知坐席
- ❌ 培训成本高：新坐席上岗需要长时间培训
- ❌ 回答不一致：不同坐席对同一问题回答不同

**实现后收益**：
- 📈 新坐席培训时间减少 **60%**（从7天 → 3天）
- 📈 坐席回答准确率提升至 **95%**（标准化知识库）
- 📈 响应速度提升 **50%**（快速查找答案）
- 📊 知识覆盖率达到 **90%**（常见问题全覆盖）
- 📊 客户满意度提升 **30%**（专业、一致的回答）

**Fiido 电动自行车场景示例**：
> 客户："D11的电池能跑多远？"
>
> 坐席（无知识库）：
> - "我记得好像是50公里...让我去查一下资料"（2分钟）
> - 回答不确定，客户信任度低
>
> 坐席（有知识库）：
> - 搜索"D11 电池 续航"，0.5秒找到标准答案
> - "D11配备48V 10.4Ah电池，纯电模式续航50-60公里，助力模式可达80-100公里"
> - 并附上官方测试数据和用户评价
> **体验**: 快速、专业、可信

---

## 📋 模块1: 知识分类体系

### 1.1 功能概述

建立科学的知识分类体系，方便知识的组织、查找和管理。

**参考对标**：
- Zendesk Guide：知识库文章分类
- Confluence：文档空间和页面树
- Notion：多层级页面结构

### 1.2 功能需求

#### 1.2.1 分类层级结构

**F1-1: 三层分类体系**

采用"分类 > 子分类 > 文章"的三层结构：

**Fiido 知识库分类示例**：

```
📚 产品知识
  ├─ 🚲 D系列电动车
  │   ├─ D11产品介绍
  │   ├─ D11技术参数
  │   ├─ D11使用指南
  │   └─ D11常见问题
  │
  ├─ 🚲 X系列折叠车
  │   ├─ X产品介绍
  │   ├─ X折叠教程
  │   └─ X常见问题
  │
  └─ 🔋 电池与充电
      ├─ 电池保养指南
      ├─ 充电注意事项
      └─ 电池续航优化

📦 订单物流
  ├─ 下单流程
  ├─ 支付方式
  ├─ 配送说明
  └─ 物流追踪

🔧 售后服务
  ├─ 保修政策
  ├─ 退换货流程
  ├─ 常见故障排查
  └─ 维修保养

💬 使用技巧
  ├─ 骑行安全
  ├─ 日常保养
  └─ 性能优化

⚙️ 系统操作
  ├─ 坐席工作流程
  ├─ 系统功能说明
  └─ 常见操作指南
```

**F1-2: 分类管理功能**

管理员可以管理知识分类：

**基础操作**：
- 创建分类：添加一级分类
- 创建子分类：在分类下添加子分类
- 编辑分类：修改名称、描述、图标
- 删除分类：删除空分类（含文章的不可删）
- 排序分类：拖拽调整分类顺序
- 移动分类：将分类移动到其他父分类下

**分类属性**：

| 属性 | 说明 | 示例 |
|-----|------|------|
| 分类ID | 唯一标识 | `cat_001` |
| 分类名称 | 显示名称 | "D系列电动车" |
| 分类图标 | Emoji或图标 | 🚲 |
| 父分类ID | 上级分类 | `cat_parent` |
| 排序权重 | 显示顺序 | 1, 2, 3... |
| 描述 | 分类说明 | "D系列产品相关知识" |
| 文章数量 | 统计 | 15 |

**F1-3: 分类视觉设计**

使用图标和颜色区分不同分类：

**图标系统**：
- 📚 产品知识
- 📦 订单物流
- 🔧 售后服务
- 💬 使用技巧
- ⚙️ 系统操作
- 🎓 培训资料

**颜色标识**：
- 蓝色：产品相关
- 绿色：订单相关
- 橙色：售后相关
- 紫色：技巧分享
- 灰色：系统说明

#### 1.2.2 标签系统

**F1-4: 文章标签**

为文章添加多个标签，支持跨分类查找：

**预设标签**（Fiido 场景）：

| 标签类型 | 标签示例 |
|---------|---------|
| 产品型号 | D11, D4S, X, M1, M1Pro |
| 问题类型 | 故障, 保养, 操作, 咨询 |
| 紧急程度 | 紧急, 重要, 一般 |
| 适用对象 | 新客户, 老客户, 坐席, 管理员 |
| 内容类型 | 图文, 视频, PDF, 链接 |

**标签管理**：
- 创建标签：管理员创建全局标签
- 标签组：将标签分组管理
- 标签别名：设置标签的同义词
- 标签合并：合并重复标签
- 标签统计：查看标签使用频率

**F1-5: 标签应用场景**

**场景1: 快速筛选**
```
坐席搜索: 标签="D11" AND 标签="电池"
结果: D11电池相关的所有文章
```

**场景2: 热门标签**
```
显示最常用的10个标签:
#D11 (120篇) #续航 (85篇) #充电 (72篇)
#保修 (65篇) #退货 (58篇) ...
```

**场景3: 相关推荐**
```
当前文章: "D11电池保养指南"
标签: #D11 #电池 #保养

相关文章推荐:
- D11电池续航优化
- 电池充电注意事项
- D11日常保养清单
```

### 1.3 数据模型

**知识分类模型**：

```typescript
interface KnowledgeCategory {
  category_id: string              // 分类ID
  name: string                     // 分类名称
  icon: string                     // 图标（emoji或图标class）
  color: string                    // 颜色标识
  parent_id: string | null         // 父分类ID（null为顶级）
  level: number                    // 层级（1/2/3）
  sort_order: number               // 排序权重
  description: string              // 分类描述

  // 统计信息
  stats: {
    articles_count: number         // 文章数量
    views_count: number            // 总浏览量
    last_updated: Date             // 最后更新时间
  }

  // 元数据
  created_by: string               // 创建人
  created_at: Date
  updated_at: Date
  is_active: boolean               // 是否启用
}

interface KnowledgeTag {
  tag_id: string                   // 标签ID
  name: string                     // 标签名称
  group: string                    // 标签组
  color: string                    // 颜色
  aliases: string[]                // 别名
  usage_count: number              // 使用次数
  created_at: Date
}
```

### 1.4 后端API设计

**分类管理API**：

```
GET    /api/knowledge/categories              # 获取分类树
POST   /api/knowledge/categories              # 创建分类
PUT    /api/knowledge/categories/:id          # 更新分类
DELETE /api/knowledge/categories/:id          # 删除分类
POST   /api/knowledge/categories/:id/move     # 移动分类
POST   /api/knowledge/categories/reorder      # 批量排序
```

**标签管理API**：

```
GET    /api/knowledge/tags                    # 获取所有标签
POST   /api/knowledge/tags                    # 创建标签
PUT    /api/knowledge/tags/:id                # 更新标签
DELETE /api/knowledge/tags/:id                # 删除标签
GET    /api/knowledge/tags/popular            # 获取热门标签
```

### 1.5 UI设计

**分类管理界面**：

```
┌─────────────────────────────────────────────────────────┐
│ 知识库分类管理                           [+ 新建分类]    │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 📚 产品知识 (45篇)                    [编辑] [删除]     │
│   ├─ 🚲 D系列电动车 (20篇)           [编辑] [删除]     │
│   │   ├─ D11产品介绍                  ⋮                │
│   │   ├─ D11技术参数                  ⋮                │
│   │   └─ D11常见问题                  ⋮                │
│   │                                                      │
│   ├─ 🚲 X系列折叠车 (15篇)           [编辑] [删除]     │
│   │   └─ ...                                            │
│   │                                                      │
│   └─ 🔋 电池与充电 (10篇)            [编辑] [删除]     │
│       └─ ...                                            │
│                                                          │
│ 📦 订单物流 (18篇)                    [编辑] [删除]     │
│   ├─ 下单流程 (5篇)                                    │
│   └─ 配送说明 (8篇)                                    │
│                                                          │
│ 🔧 售后服务 (32篇)                    [编辑] [删除]     │
│   └─ ...                                                │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

**标签管理界面**：

```
┌─────────────────────────────────────────────────────────┐
│ 标签管理                                 [+ 新建标签]    │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 产品型号 (6个标签)                                       │
│ [D11 120] [D4S 85] [X 92] [M1 65] [M1Pro 48] [D2S 31]  │
│                                                          │
│ 问题类型 (4个标签)                                       │
│ [故障 78] [保养 65] [操作 120] [咨询 95]                │
│                                                          │
│ 紧急程度 (3个标签)                                       │
│ [紧急 25] [重要 68] [一般 180]                          │
│                                                          │
│ 适用对象 (4个标签)                                       │
│ [新客户 45] [老客户 38] [坐席 92] [管理员 18]            │
│                                                          │
│ [查看全部标签]                                           │
└─────────────────────────────────────────────────────────┘
```

### 1.6 验收标准

**功能验收**：
- [ ] 可创建三层分类结构
- [ ] 可编辑分类名称、图标、描述
- [ ] 可删除空分类
- [ ] 可拖拽排序分类
- [ ] 可移动分类到其他父分类
- [ ] 可创建和管理标签
- [ ] 可设置标签别名
- [ ] 可查看标签使用统计

**数据完整性验收**：
- [ ] 删除分类时检查是否包含文章
- [ ] 移动分类时保持文章关联
- [ ] 标签合并时更新所有关联文章
- [ ] 分类树结构无循环引用

**UI验收**：
- [ ] 分类树展示清晰
- [ ] 图标和颜色正确显示
- [ ] 拖拽排序流畅
- [ ] 标签云显示美观

---

## 📋 模块2: 知识内容管理

### 2.1 功能概述

提供完整的知识文章创建、编辑、版本控制功能，支持富文本、图片、视频等多种内容格式。

**参考对标**：
- Zendesk：知识库文章编辑器
- Notion：块编辑器
- WordPress：文章管理系统

### 2.2 功能需求

#### 2.2.1 文章创建与编辑

**F2-1: 富文本编辑器**

提供功能丰富的可视化编辑器：

**基础格式**：
- 文本格式：粗体、斜体、下划线、删除线
- 标题：H1-H6
- 列表：有序列表、无序列表、任务列表
- 引用块
- 代码块：支持语法高亮
- 分割线

**高级功能**：
- 表格：插入和编辑表格
- 图片：上传图片，支持拖拽、粘贴
- 视频：嵌入YouTube、优酷等视频
- 附件：上传PDF、Word等文档
- 链接：内部链接、外部链接
- 折叠区域：可折叠的内容区域

**Fiido 场景应用**：
```markdown
# D11 电池续航指南

## 技术参数
- 电池容量：48V 10.4Ah
- 续航里程：纯电 50-60km / 助力 80-100km
- 充电时间：4-6小时

## 续航影响因素

| 因素 | 影响程度 | 优化建议 |
|-----|---------|---------|
| 骑行模式 | ⭐⭐⭐ | 使用助力模式可延长续航 |
| 路况 | ⭐⭐ | 平路比爬坡更省电 |
| 气温 | ⭐⭐ | 低温会降低续航10-20% |
| 载重 | ⭐ | 减少负重可延长续航 |

## 实测数据

[图片: 续航测试曲线图]

## 用户评价

> "我体重75kg，日常通勤路线15km，纯电模式可以骑3-4天。" - 用户A
> "助力模式非常省电，一周充一次电完全够用。" - 用户B

## 相关视频

[嵌入: D11续航实测视频 - YouTube]

## 常见问题

<details>
<summary>Q: 电池能用多久需要更换？</summary>
A: 正常使用3-5年，充放电500-800次后容量会衰减到80%。
</details>
```

**F2-2: 文章属性设置**

为文章设置丰富的属性：

**基础属性**：

| 属性 | 说明 | 示例 |
|-----|------|------|
| 文章标题 | 显示标题 | "D11电池续航指南" |
| 分类 | 所属分类 | 产品知识 > D系列 |
| 标签 | 多个标签 | #D11 #电池 #续航 |
| 摘要 | 文章摘要 | "详细介绍D11电池续航..." |
| 封面图 | 缩略图 | [上传图片] |
| 作者 | 创建人 | agent001 |
| 状态 | 发布状态 | 草稿/审核中/已发布 |

**高级属性**：

| 属性 | 说明 |
|-----|------|
| SEO关键词 | 搜索优化关键词 |
| 相关文章 | 手动关联相关文章 |
| 推荐星级 | 文章重要性（1-5星） |
| 阅读权限 | 公开/仅坐席/仅管理员 |
| 有效期 | 文章过期时间 |
| 外部链接 | 关联外部资源 |

**F2-3: 模板系统**

提供预设模板，快速创建标准化文章：

**模板类型**：

1. **产品介绍模板**
   ```markdown
   # [产品名称]

   ## 产品概述
   [产品简介、定位、特色]

   ## 技术参数
   [参数表格]

   ## 产品特点
   [特点列表]

   ## 适用场景
   [使用场景描述]

   ## 购买指南
   [价格、优惠、购买链接]
   ```

2. **常见问题模板**
   ```markdown
   # [问题标题]

   ## 问题描述
   [详细描述问题]

   ## 解决方案
   ### 方案一：[方案名称]
   [步骤1、2、3...]

   ### 方案二：[方案名称]
   [步骤1、2、3...]

   ## 注意事项
   [需要注意的地方]

   ## 相关问题
   [链接到相关文章]
   ```

3. **故障排查模板**
   ```markdown
   # [故障现象]

   ## 可能原因
   1. 原因A
   2. 原因B
   3. 原因C

   ## 排查步骤
   [流程图或步骤说明]

   ## 解决方法
   [针对不同原因的解决方法]

   ## 预防措施
   [如何避免再次发生]
   ```

#### 2.2.2 版本控制

**F2-4: 版本历史**

记录文章的所有修改历史：

**版本信息**：
```typescript
interface ArticleVersion {
  version_id: string               // 版本ID
  version_number: number           // 版本号（1, 2, 3...）
  title: string                    // 文章标题
  content: string                  // 文章内容
  change_summary: string           // 变更说明
  modified_by: string              // 修改人
  modified_at: Date                // 修改时间
  is_current: boolean              // 是否当前版本
}
```

**版本对比**：
- 并排对比：左右显示两个版本
- 高亮差异：新增内容绿色，删除内容红色
- 逐字对比：精确到字符级别

**版本回滚**：
- 查看历史版本
- 恢复到指定版本
- 合并版本（高级功能）

**F2-5: 自动保存**

编辑过程中自动保存草稿：

**保存策略**：
- 每30秒自动保存一次
- 内容变化时触发保存
- 退出编辑器前提示保存
- 保存历史可恢复（最近10个草稿）

**冲突处理**：
```
场景：两个坐席同时编辑同一文章

解决方案：
1. 后保存者收到冲突提示
2. 显示两个版本的差异
3. 选择保留哪个版本，或手动合并
```

#### 2.2.3 多媒体管理

**F2-6: 图片管理**

**上传方式**：
- 点击上传：选择本地图片
- 拖拽上传：拖入编辑器
- 粘贴上传：Ctrl+V粘贴
- URL引用：输入图片URL

**图片处理**：
- 自动压缩：超过2MB自动压缩
- 尺寸调整：拖拽调整显示尺寸
- 对齐方式：左对齐、居中、右对齐
- 图片描述：添加Alt文本

**F2-7: 视频与文件**

**视频支持**：
- 嵌入链接：YouTube、优酷、B站等
- 上传视频：支持MP4格式（< 100MB）
- 视频封面：自定义封面图

**附件管理**：
- 支持格式：PDF、Word、Excel、ZIP
- 文件大小：单个文件 < 50MB
- 下载统计：记录下载次数
- 过期管理：设置文件有效期

### 2.3 数据模型

**知识文章模型**：

```typescript
interface KnowledgeArticle {
  article_id: string               // 文章ID
  title: string                    // 标题
  slug: string                     // URL友好标识
  category_id: string              // 分类ID
  tags: string[]                   // 标签数组

  // 内容
  content: {
    markdown: string               // Markdown原文
    html: string                   // 渲染后的HTML
    excerpt: string                // 摘要
    cover_image: string            // 封面图URL
  }

  // 元数据
  metadata: {
    author_id: string              // 作者
    created_at: Date
    updated_at: Date
    published_at: Date             // 发布时间
    status: string                 // 草稿/审核/发布/下架
    version: number                // 当前版本号
  }

  // 高级属性
  properties: {
    importance: number             // 重要性 (1-5)
    seo_keywords: string[]         // SEO关键词
    related_articles: string[]     // 相关文章ID
    permission: string             // public/agent/admin
    expiry_date: Date | null       // 过期时间
    external_links: string[]       // 外部链接
  }

  // 统计数据
  stats: {
    views_count: number            // 浏览次数
    helpful_count: number          // 有帮助次数
    unhelpful_count: number        // 无帮助次数
    avg_read_time: number          // 平均阅读时间（秒）
    last_viewed: Date              // 最后浏览时间
  }

  // 媒体资源
  media: {
    images: string[]               // 图片URL数组
    videos: string[]               // 视频URL数组
    attachments: Array<{
      filename: string
      url: string
      size: number
      mime_type: string
      downloads: number
    }>
  }
}
```

### 2.4 后端API设计

**文章管理API**：

```
GET    /api/knowledge/articles                 # 获取文章列表
POST   /api/knowledge/articles                 # 创建文章
GET    /api/knowledge/articles/:id             # 获取文章详情
PUT    /api/knowledge/articles/:id             # 更新文章
DELETE /api/knowledge/articles/:id             # 删除文章
POST   /api/knowledge/articles/:id/publish     # 发布文章
POST   /api/knowledge/articles/:id/unpublish   # 下架文章
GET    /api/knowledge/articles/:id/versions    # 获取版本历史
POST   /api/knowledge/articles/:id/revert      # 恢复到指定版本
```

**媒体管理API**：

```
POST   /api/knowledge/media/upload             # 上传图片/文件
DELETE /api/knowledge/media/:id                # 删除媒体文件
GET    /api/knowledge/media/:id/download       # 下载附件
```

### 2.5 UI设计

**文章编辑器**：

```
┌──────────────────────────────────────────────────────────┐
│ 编辑文章                    [保存草稿] [提交审核] [取消] │
├──────────────────────────────────────────────────────────┤
│                                                           │
│ 标题: [D11 电池续航指南_________________________________]│
│                                                           │
│ 分类: [产品知识 ▼] > [D系列电动车 ▼]                     │
│                                                           │
│ 标签: [#D11] [#电池] [#续航] [+ 添加标签]                │
│                                                           │
│ ┌──────────────────────────────────────────────────────┐│
│ │ 编辑器工具栏                                          ││
│ │ [B] [I] [U] [H1▼] [列表▼] [链接] [图片] [表格] ...  ││
│ ├──────────────────────────────────────────────────────┤│
│ │                                                       ││
│ │ # D11 电池续航指南                                    ││
│ │                                                       ││
│ │ ## 技术参数                                           ││
│ │ - 电池容量：48V 10.4Ah                                ││
│ │ - 续航里程：纯电 50-60km / 助力 80-100km              ││
│ │                                                       ││
│ │ [插入的图片]                                          ││
│ │                                                       ││
│ │ ...                                                   ││
│ │                                                       ││
│ │                                                       ││
│ │                                                       ││
│ └──────────────────────────────────────────────────────┘│
│                                                           │
│ ┌────────────── 文章设置 ────────────────┐              │
│ │ 封面图: [上传图片]                      │              │
│ │ 摘要: [文章摘要_______________________] │              │
│ │ 重要性: ⭐⭐⭐⭐⭐                       │              │
│ │ 阅读权限: [所有人 ▼]                   │              │
│ │ 相关文章: [选择相关文章]                │              │
│ └─────────────────────────────────────────┘              │
│                                                           │
│ 自动保存于 2025-01-27 14:30:15                           │
└──────────────────────────────────────────────────────────┘
```

### 2.6 验收标准

**功能验收**：
- [ ] 富文本编辑器功能完整
- [ ] 支持Markdown语法
- [ ] 可插入图片、视频、附件
- [ ] 可使用预设模板创建文章
- [ ] 版本历史记录完整
- [ ] 版本对比高亮差异
- [ ] 可回滚到历史版本
- [ ] 自动保存功能正常
- [ ] 冲突检测和处理

**内容质量验收**：
- [ ] 图片自动压缩
- [ ] 视频正常嵌入和播放
- [ ] 表格样式美观
- [ ] 代码高亮正确
- [ ] 链接可正常跳转

**性能验收**：
- [ ] 编辑器加载时间 < 1秒
- [ ] 图片上传时间 < 3秒
- [ ] 自动保存延迟 < 500ms
- [ ] 版本对比响应时间 < 1秒

---

## 📋 模块3: 权限与审核

### 3.1 功能概述

建立完善的权限管理和审核流程，确保知识库内容的准确性和安全性。

**参考对标**：
- Confluence：空间权限和页面权限
- WordPress：角色和权限管理
- Zendesk：内容审核工作流

### 3.2 功能需求

#### 3.2.1 角色与权限

**F3-1: 角色定义**

定义不同角色的知识库权限：

| 角色 | 查看 | 创建 | 编辑 | 删除 | 审核 | 发布 | 管理分类 |
|-----|------|------|------|------|------|------|---------|
| 👁️ 访客 | ✅ 公开文章 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 🎧 坐席 | ✅ 所有文章 | ✅ | ✅ 自己的 | ❌ | ❌ | ❌ | ❌ |
| ⭐ 高级坐席 | ✅ 所有文章 | ✅ | ✅ 所有 | ✅ 自己的 | ❌ | ❌ | ❌ |
| 📝 知识库编辑 | ✅ 所有文章 | ✅ | ✅ 所有 | ✅ 所有 | ✅ | ✅ | ✅ |
| 👑 管理员 | ✅ 所有文章 | ✅ | ✅ 所有 | ✅ 所有 | ✅ | ✅ | ✅ |

**F3-2: 细粒度权限控制**

**文章级权限**：
- 公开文章：所有人可查看
- 内部文章：仅坐席及以上可查看
- 私密文章：仅创建者和管理员可查看

**分类级权限**：
- 开放分类：所有角色可访问
- 限制分类：特定角色可访问
- 敏感分类：仅管理员可访问

**示例**：
```
分类：⚙️ 系统操作（限制分类）
  - 权限：仅坐席及以上可查看
  - 原因：包含内部系统操作指南，不对外公开

分类：💰 价格策略（敏感分类）
  - 权限：仅管理员可查看
  - 原因：包含定价策略和利润信息
```

#### 3.2.2 审核流程

**F3-3: 三级审核流程**

**流程节点**：

```
草稿 → 待审核 → 已通过 → 已发布
         ↓
       已拒绝（返回草稿）
```

**审核规则**：

| 文章类型 | 审核要求 |
|---------|---------|
| 新建文章 | 必须审核 |
| 重要文章（5星） | 双重审核（编辑 + 管理员） |
| 编辑文章 | 根据修改内容决定是否重新审核 |
| 紧急文章 | 管理员快速审核通道 |

**F3-4: 审核操作**

**审核者操作**：
- 通过：文章进入已发布状态
- 拒绝：返回草稿，需要说明原因
- 请求修改：指出需要修改的地方
- 转交审核：转给其他审核者

**审核界面**：
```
┌─────────────────────────────────────────────┐
│ 审核文章: D11 电池续航指南                   │
├─────────────────────────────────────────────┤
│                                              │
│ 作者: agent001 (张小明)                     │
│ 提交时间: 2025-01-27 14:30                  │
│ 分类: 产品知识 > D系列电动车                 │
│ 标签: #D11 #电池 #续航                      │
│                                              │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                              │
│ [文章预览内容]                               │
│                                              │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                              │
│ 审核意见:                                    │
│ ┌──────────────────────────────────────┐  │
│ │ [输入审核意见]                        │  │
│ │                                       │  │
│ └──────────────────────────────────────┘  │
│                                              │
│ [✅ 通过] [❌ 拒绝] [✏️ 请求修改] [转交▼] │
│                                              │
└─────────────────────────────────────────────┘
```

**F3-5: 审核记录**

记录文章的完整审核历史：

```typescript
interface AuditRecord {
  audit_id: string
  article_id: string
  auditor_id: string               // 审核人
  action: string                   // 通过/拒绝/请求修改
  comment: string                  // 审核意见
  audited_at: Date
}
```

**审核历史展示**：
```
┌─────────────────────────────────────┐
│ 审核历史                             │
├─────────────────────────────────────┤
│                                      │
│ ✅ 2025-01-27 15:00                 │
│    审核通过 - admin                  │
│    意见: 内容准确，可以发布          │
│                                      │
│ ✏️ 2025-01-27 14:50                 │
│    请求修改 - editor001              │
│    意见: 请补充实测数据和用户评价    │
│                                      │
│ 📝 2025-01-27 14:30                 │
│    提交审核 - agent001               │
│                                      │
└─────────────────────────────────────┘
```

#### 3.2.3 发布控制

**F3-6: 发布管理**

**发布方式**：
- 立即发布：审核通过后立即生效
- 定时发布：设置发布时间
- 手动发布：审核通过后等待手动发布

**发布前检查**：
- 内容完整性：标题、内容、分类、标签必填
- 图片有效性：检查图片链接是否有效
- 链接有效性：检查外部链接是否可访问
- 格式规范：检查排版是否符合规范

**F3-7: 版本发布**

**版本管理**：
- 草稿版本：编辑中的版本
- 发布版本：当前线上版本
- 历史版本：过往发布的版本

**版本切换**：
```
场景：发现已发布文章有错误

操作流程：
1. 创建新草稿（基于当前发布版本）
2. 修改内容
3. 提交审核
4. 审核通过后，替换发布版本
5. 原发布版本进入历史版本
```

**F3-8: 下架与归档**

**下架**：
- 临时下架：暂时不展示，可重新发布
- 永久下架：标记为已废弃

**归档**：
- 过期文章自动归档
- 手动归档不再使用的文章
- 归档文章不显示在列表中，但可搜索

### 3.3 数据模型

**权限配置模型**：

```typescript
interface PermissionConfig {
  role: string                     // 角色
  permissions: {
    view: string[]                 // 可查看的分类ID
    create: boolean
    edit: string[]                 // 可编辑的范围: own/all
    delete: string[]               // 可删除的范围
    approve: boolean               // 可审核
    publish: boolean               // 可发布
    manage_category: boolean       // 可管理分类
  }
}

interface ArticleWorkflow {
  article_id: string
  status: string                   // draft/pending/approved/published/rejected
  workflow_history: Array<{
    from_status: string
    to_status: string
    operated_by: string
    operated_at: Date
    comment: string
  }>
  current_auditor: string          // 当前审核人
  scheduled_publish: Date | null   // 定时发布时间
}
```

### 3.4 后端API设计

**权限管理API**：

```
GET    /api/knowledge/permissions/:role         # 获取角色权限
PUT    /api/knowledge/permissions/:role         # 更新角色权限
GET    /api/knowledge/articles/:id/permission   # 获取文章权限
PUT    /api/knowledge/articles/:id/permission   # 设置文章权限
```

**审核管理API**：

```
GET    /api/knowledge/articles/pending          # 获取待审核文章列表
POST   /api/knowledge/articles/:id/submit       # 提交审核
POST   /api/knowledge/articles/:id/approve      # 审核通过
POST   /api/knowledge/articles/:id/reject       # 审核拒绝
GET    /api/knowledge/articles/:id/audit-log    # 获取审核历史
```

**发布管理API**：

```
POST   /api/knowledge/articles/:id/publish      # 发布文章
POST   /api/knowledge/articles/:id/unpublish    # 下架文章
POST   /api/knowledge/articles/:id/archive      # 归档文章
POST   /api/knowledge/articles/:id/schedule     # 定时发布
```

### 3.5 验收标准

**功能验收**：
- [ ] 角色权限配置正确
- [ ] 文章级权限控制生效
- [ ] 分类级权限控制生效
- [ ] 审核流程完整
- [ ] 审核通过后正确发布
- [ ] 审核拒绝后返回草稿
- [ ] 审核历史记录完整
- [ ] 定时发布功能正常
- [ ] 发布前检查生效
- [ ] 下架和归档功能正常

**权限验收**：
- [ ] 坐席无法删除他人文章
- [ ] 访客无法查看内部文章
- [ ] 普通坐席无法审核文章
- [ ] 权限越权访问被拒绝

**流程验收**：
- [ ] 审核通知及时发送
- [ ] 审核意见正确传达
- [ ] 版本切换无数据丢失

---

## 🔗 与其他模块的关系

**依赖关系**：
- **依赖**: v3.1+ JWT认证系统（权限控制）
- **被依赖**: L2-3-Part2 知识搜索与统计

**数据流**：
```
创建文章 → 编辑内容 → 提交审核
  ↓
审核流程 → 通过 → 发布
  ↓
知识搜索 ← 坐席查询 ← 客户咨询
  ↓
统计分析 → 优化知识库
```

---

## 📊 开发优先级

### 第一阶段（P0 - 必须实现）
- [ ] 分类管理（三层结构）
- [ ] 基础富文本编辑器
- [ ] 文章创建和编辑
- [ ] 基础权限控制（角色）
- [ ] 简单审核流程（草稿 → 发布）

### 第二阶段（P1 - 重要）
- [ ] 标签系统
- [ ] 图片上传和管理
- [ ] 版本历史和对比
- [ ] 完整审核流程
- [ ] 发布管理

### 第三阶段（P2 - 优化）
- [ ] 模板系统
- [ ] 视频和附件支持
- [ ] 版本回滚
- [ ] 定时发布
- [ ] 细粒度权限

---

## 🧪 测试要点

### 单元测试
- 权限判断逻辑
- 审核流程状态机
- 版本对比算法
- 自动保存机制

### 集成测试
- 完整的文章创建发布流程
- 多人协作编辑冲突处理
- 审核流程端到端测试
- 权限控制边界测试

### 性能测试
- 1000篇文章列表加载
- 大文档（10MB）编辑性能
- 图片批量上传
- 版本历史查询

---

## 📝 实施注意事项

### 技术约束
1. **编辑器选择**：推荐使用 TinyMCE 或 Quill
2. **版本存储**：使用diff算法压缩存储，节省空间
3. **图片存储**：使用OSS存储，CDN加速
4. **审核通知**：使用消息队列异步通知

### 开发建议
1. 先实现分类和文章管理，再实现审核流程
2. 先实现基础编辑器，再逐步增强功能
3. 使用成熟的富文本编辑器组件
4. 版本控制使用Git思想实现

### Fiido 电动自行车业务特点
- 产品更新频繁：需要及时更新知识库
- 技术性强：需要支持表格、图表等
- 多语言需求：考虑未来国际化
- 视频教程多：需要良好的视频支持

---

## 📚 参考资料

- **Markdown语法**: https://www.markdownguide.org/
- **TinyMCE编辑器**: https://www.tiny.cloud/
- **Git版本控制**: https://git-scm.com/book/en/v2
- **技术约束**: `prd/02_约束与原则/CONSTRAINTS_AND_PRINCIPLES.md`
- **API契约**: `prd/03_技术方案/api_contract.md`

---

**下一步**: 阅读 `L2-3-Part2_知识搜索与统计.md`

**文档维护者**: Claude Code
**最后更新**: 2025-01-27
