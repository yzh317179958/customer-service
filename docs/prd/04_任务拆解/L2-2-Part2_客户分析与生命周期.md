# L2-2-Part2: 客户分析与生命周期管理

> **文档编号**: L2-2-Part2
> **文档版本**: v1.0
> **优先级**: P1（增强层 - 重要）
> **状态**: ❌ 待开发
> **创建时间**: 2025-01-27
> **最后更新**: 2025-01-27

---

## 📑 文档导航

- **上级文档**: [ENTERPRISE_EBIKE_SUPPORT_TASKS.md](./ENTERPRISE_EBIKE_SUPPORT_TASKS.md)
- **同级文档**:
  - 上一篇: L2-2-Part1 客户基础信息与行为
  - 当前: L2-2-Part2 客户分析与生命周期
  - 下一篇: L2-3-Part1 知识库管理
- **依赖关系**: 依赖 L2-2-Part1 客户基础信息与行为、L2-1 Shopify订单集成

---

## 🎯 Part 2 概述

### 涵盖模块

本文档包含客户画像系统的高级分析模块：

| 模块编号 | 模块名称 | 核心功能 |
|---------|---------|---------|
| **模块3** | 购买偏好分析 | 产品偏好、价格敏感度、购买周期 |
| **模块4** | RFM客户分析 | 最近购买、购买频率、消费金额分析 |
| **模块5** | 客户生命周期管理 | 新客转化、活跃维护、流失预警、挽回策略 |

### 业务价值

**当前痛点**（依赖 L2-2-Part1 完成后）：
- ✅ 已有客户基础信息和行为追踪
- ❌ 无法识别客户购买偏好：坐席不知道客户喜欢什么
- ❌ 无法评估客户价值：不知道哪些是高价值客户
- ❌ 无法预测客户流失：客户流失后才发现
- ❌ 缺少个性化营销：所有客户一视同仁

**实现后收益**：
- 📈 个性化推荐转化率提升 **45%**（基于购买偏好）
- 📈 高价值客户识别准确率 **90%**（RFM分析）
- 📈 客户流失率降低 **30%**（提前预警和挽回）
- 📊 营销ROI提升 **50%**（精准营销）
- 📊 客户生命周期价值（CLV）提升 **35%**

**Fiido 电动自行车场景示例**：
> 传统营销（无分析）：
> - 向所有客户推送相同的促销信息
> - 客户流失后才发现，无法挽回
> - 不知道客户偏好，推荐不准确
> **结果**: 转化率低，客户流失高
>
> 智能营销（有分析）：
> - 识别客户偏好"黑色、电动助力型"
> - RFM分析识别高价值客户
> - 30天未互动自动触发关怀
> - 个性化推荐匹配度高的产品
> **结果**: 转化率高，客户满意度高

---

## 📋 模块3: 购买偏好分析

### 3.1 功能概述

通过分析客户的历史订单、浏览记录、咨询内容，识别客户的购买偏好和决策模式。

**参考对标**：
- 淘宝：千人千面推荐
- 京东：智能推荐系统
- Amazon：基于购买历史的推荐

### 3.2 功能需求

#### 3.2.1 产品偏好分析

**F3-1: 产品类型偏好**

分析客户偏好的产品类型（Fiido 场景）：

| 产品类型 | 识别依据 | 示例 |
|---------|---------|------|
| 电动助力型 | 浏览/购买记录 | Fiido D11, D4S |
| 全电动型 | 浏览/购买记录 | Fiido X, M1 Pro |
| 折叠型 | 浏览/购买记录 | Fiido X, D2S |
| 通勤型 | 用途咨询 | 适合城市通勤 |
| 运动型 | 用途咨询 | 适合山地骑行 |

**偏好计算**：
```
偏好分数 = 购买次数 × 5 + 浏览次数 × 2 + 咨询次数 × 3
```

**F3-2: 颜色偏好**

统计客户偏好的颜色：

**数据来源**：
- 购买历史：已购买的产品颜色
- 浏览记录：点击查看的产品颜色
- 咨询内容：对话中提到的颜色偏好

**展示效果**：
```
颜色偏好:
  🥇 黑色 (60%)    ████████████
  🥈 白色 (25%)    █████
  🥉 红色 (15%)    ███
```

**F3-3: 价格敏感度分析**

评估客户的价格敏感度：

| 价格区间 | 定义 | Fiido 产品 |
|---------|------|-----------|
| 预算型 | < $800 | D2S, D4S |
| 中端型 | $800 - $1,500 | D11, M1 |
| 高端型 | > $1,500 | X, M1 Pro |

**敏感度评级**：

| 评级 | 特征 | 推荐策略 |
|-----|------|---------|
| 高度敏感 | 总是购买促销品、询问折扣 | 强调性价比、优惠活动 |
| 中度敏感 | 关注价格但不是决定因素 | 平衡性价比和品质 |
| 不敏感 | 直接购买高端产品 | 强调品质和独特性 |

**F3-4: 购买周期分析**

分析客户的购买频率和周期：

**分析指标**：
- 平均购买间隔：两次购买之间的平均天数
- 购买频率：每年购买次数
- 复购率：重复购买的概率

**Fiido 场景应用**：
```
客户购买周期: 180天
上次购买: 2024-11-27 (距今60天)
预计下次购买: 2025-05-27 (120天后)

建议: 在预计购买日期前30天发送营销信息
```

#### 3.2.2 购买决策分析

**F3-5: 决策因素识别**

识别影响客户购买决策的关键因素：

**决策因素分类**：

| 因素 | 识别方式 | 权重 |
|-----|---------|------|
| 价格 | 多次询问价格、折扣 | 高 |
| 性能 | 咨询续航、速度、爬坡能力 | 高 |
| 外观 | 询问颜色、设计 | 中 |
| 品牌 | 询问品牌历史、口碑 | 中 |
| 售后 | 咨询保修、退换货政策 | 中 |
| 配送 | 询问配送时间、费用 | 低 |

**F3-6: 购买意向评分**

评估客户当前的购买意向：

**评分模型**：
```typescript
interface PurchaseIntent {
  score: number                    // 0-100 分
  level: 'high' | 'medium' | 'low' // 意向等级
  indicators: string[]             // 判断依据
  recommended_actions: string[]    // 建议动作
  probability: number              // 成交概率 (0-1)
}
```

**意向判断依据**：

| 意向等级 | 行为特征 | 成交概率 |
|---------|---------|---------|
| 高意向 | 加入购物车 + 多次咨询 + 询问配送 | 70-90% |
| 中意向 | 多次浏览 + 咨询产品详情 | 30-50% |
| 低意向 | 仅浏览产品页面 | 5-15% |

**展示效果**：
```
┌─────────────────────────────────────┐
│ 购买意向分析                         │
├─────────────────────────────────────┤
│                                      │
│ 意向评分: 85/100 🔥 高意向          │
│ 成交概率: 75%                        │
│                                      │
│ 判断依据:                            │
│ ✅ 已加入购物车（D11 黑色）          │
│ ✅ 咨询了3次产品详情                 │
│ ✅ 询问了配送时间和退货政策          │
│ ✅ 30天内浏览了5次产品页面           │
│                                      │
│ 建议动作:                            │
│ 💡 主动联系，提供限时优惠             │
│ 💡 发送客户评价和使用案例             │
│ 💡 提醒库存有限，促进下单             │
│                                      │
└─────────────────────────────────────┘
```

### 3.3 数据模型

**购买偏好模型**：

```typescript
interface PurchasePreference {
  customer_id: string

  // 产品偏好
  product_preferences: {
    categories: Array<{
      category: string             // 产品类型
      score: number                // 偏好分数
      percentage: number           // 偏好占比
    }>
    colors: Array<{
      color: string
      percentage: number
    }>
    price_range: {
      min: number
      max: number
      average: number
      sensitivity: 'high' | 'medium' | 'low'
    }
  }

  // 购买周期
  purchase_cycle: {
    average_interval_days: number  // 平均购买间隔
    purchase_frequency: number     // 年购买频率
    repurchase_rate: number        // 复购率 (0-1)
    last_purchase_date: Date
    predicted_next_purchase: Date
  }

  // 决策因素
  decision_factors: Array<{
    factor: string                 // 因素名称
    weight: number                 // 权重 (0-1)
    mentions_count: number         // 提及次数
  }>

  // 购买意向
  purchase_intent: {
    score: number                  // 0-100
    level: 'high' | 'medium' | 'low'
    indicators: string[]
    probability: number            // 0-1
    updated_at: Date
  }
}
```

### 3.4 验收标准

**功能验收**：
- [ ] 产品类型偏好识别准确（基于购买/浏览/咨询）
- [ ] 颜色偏好统计正确
- [ ] 价格敏感度评级准确
- [ ] 购买周期预测误差 < 20%
- [ ] 决策因素识别正确
- [ ] 购买意向评分准确度 > 80%
- [ ] 建议动作合理

**展示验收**：
- [ ] 偏好数据清晰展示
- [ ] 购买意向评分醒目
- [ ] 建议动作易于执行

---

## 📋 模块4: RFM客户分析

### 4.1 功能概述

使用RFM模型（Recency最近购买、Frequency购买频率、Monetary消费金额）对客户进行价值分级。

**参考对标**：
- CRM系统标准RFM模型
- 电商平台客户分级体系

### 4.2 功能需求

#### 4.2.1 RFM指标计算

**F4-1: Recency（最近购买）**

计算客户最后一次购买距今的天数：

| R值 | 天数范围 | 评分 | 说明 |
|-----|---------|------|------|
| R5 | 0-30天 | 5 | 非常活跃 |
| R4 | 31-60天 | 4 | 活跃 |
| R3 | 61-90天 | 3 | 一般 |
| R2 | 91-180天 | 2 | 沉睡 |
| R1 | > 180天 | 1 | 流失 |

**F4-2: Frequency（购买频率）**

计算客户的累计订单数：

| F值 | 订单数 | 评分 | 说明 |
|-----|-------|------|------|
| F5 | ≥ 10 | 5 | 忠诚客户 |
| F4 | 5-9 | 4 | 重复购买 |
| F3 | 3-4 | 3 | 普通客户 |
| F2 | 2 | 2 | 二次购买 |
| F1 | 1 | 1 | 新客户 |

**F4-3: Monetary（消费金额）**

计算客户的累计消费金额：

| M值 | 金额范围（Fiido） | 评分 | 说明 |
|-----|------------------|------|------|
| M5 | ≥ $5,000 | 5 | 高价值 |
| M4 | $3,000-$4,999 | 4 | 中高价值 |
| M3 | $1,500-$2,999 | 3 | 中等价值 |
| M2 | $500-$1,499 | 2 | 低价值 |
| M1 | < $500 | 1 | 潜在客户 |

#### 4.2.2 客户分群

**F4-4: RFM客户分群**

基于RFM评分将客户分为不同群体：

| 客户群 | RFM特征 | 占比 | 营销策略 |
|-------|---------|-----|---------|
| 💎 重要价值客户 | R5 F5 M5 | 5% | VIP专属服务、高端新品优先推荐 |
| 🌟 重要发展客户 | R5 F4-5 M3-4 | 10% | 培养成VIP，提供会员权益 |
| ⭐ 重要保持客户 | R4-5 F3-4 M3-4 | 20% | 定期关怀，维持活跃度 |
| 🔔 重要挽留客户 | R2-3 F4-5 M4-5 | 10% | 流失预警，专人跟进挽回 |
| 📈 一般价值客户 | R3-4 F2-3 M2-3 | 25% | 标准营销，促进复购 |
| 😴 一般发展客户 | R4-5 F1-2 M1-2 | 15% | 新客培养，引导二次购买 |
| ⚠️ 一般挽留客户 | R2-3 F2-3 M2-3 | 10% | 唤醒营销，折扣刺激 |
| 💤 流失客户 | R1 任意F M | 5% | 流失挽回，大力度优惠 |

**F4-5: 客户价值评分**

综合RFM计算客户价值总分：

**计算公式**：
```
客户价值分 = (R评分 × 0.3) + (F评分 × 0.4) + (M评分 × 0.3)
```

**价值等级**：

| 价值等级 | 总分范围 | 标识 |
|---------|---------|------|
| 极高价值 | 4.5-5.0 | 💎💎💎 |
| 高价值 | 4.0-4.4 | 💎💎 |
| 中价值 | 3.0-3.9 | 💎 |
| 低价值 | 2.0-2.9 | ⚡ |
| 潜在客户 | 1.0-1.9 | 🌱 |

#### 4.2.3 RFM可视化

**F4-6: RFM仪表盘**

在坐席工作台显示客户的RFM分析：

**展示布局**：
```
┌─────────────────────────────────────────┐
│ RFM 客户价值分析                         │
├─────────────────────────────────────────┤
│                                          │
│ 客户群: 💎 重要价值客户                  │
│ 价值评分: 4.8/5.0  💎💎💎               │
│                                          │
│ ┌──────────────────────────────────┐   │
│ │ R - 最近购买: 5分 (15天前)        │   │
│ │ ████████████████████ 非常活跃     │   │
│ │                                   │   │
│ │ F - 购买频率: 5分 (12次订单)      │   │
│ │ ████████████████████ 忠诚客户     │   │
│ │                                   │   │
│ │ M - 消费金额: 5分 ($6,299.00)     │   │
│ │ ████████████████████ 高价值       │   │
│ └──────────────────────────────────┘   │
│                                          │
│ 营销建议:                                │
│ 🎁 提供VIP专属新品体验                   │
│ 🎁 邀请参加线下骑行活动                   │
│ 🎁 定期发送定制化产品推荐                 │
│                                          │
│ 风险提示: 无                             │
│                                          │
└─────────────────────────────────────────┘
```

**F4-7: 客户分群统计**

管理员可查看整体客户分群情况：

**统计视图**：
```
┌─────────────────────────────────────────┐
│ 客户分群统计                   总计: 1000│
├─────────────────────────────────────────┤
│                                          │
│ 💎 重要价值客户    50 (5%)   ████       │
│ 🌟 重要发展客户   100 (10%)  ████████   │
│ ⭐ 重要保持客户   200 (20%)  ████████████│
│ 🔔 重要挽留客户   100 (10%)  ████████   │
│ 📈 一般价值客户   250 (25%)  ████████████│
│ 😴 一般发展客户   150 (15%)  ██████████ │
│ ⚠️ 一般挽留客户   100 (10%)  ████████   │
│ 💤 流失客户        50 (5%)   ████       │
│                                          │
│ 高价值客户占比: 35% (前3类)              │
│ 需关注客户: 150人 (挽留 + 流失)          │
│                                          │
│ [导出分群数据] [批量营销]                │
└─────────────────────────────────────────┘
```

### 4.3 数据模型

**RFM分析模型**：

```typescript
interface RFMAnalysis {
  customer_id: string

  // RFM原始数据
  rfm_data: {
    recency: {
      days: number                 // 距离最后购买天数
      score: number                // R评分 (1-5)
      level: string                // 活跃度等级
    }
    frequency: {
      orders_count: number         // 订单数
      score: number                // F评分 (1-5)
      level: string                // 购买频率等级
    }
    monetary: {
      total_spent: number          // 累计消费
      score: number                // M评分 (1-5)
      level: string                // 价值等级
    }
  }

  // 客户分群
  segment: {
    group: string                  // 客户群名称
    group_id: string               // 客户群ID
    value_score: number            // 客户价值总分 (1-5)
    value_tier: string             // 价值等级
    marketing_strategy: string[]   // 营销策略建议
    risk_level: string             // 风险等级: none/low/medium/high
  }

  // 更新时间
  updated_at: Date
  calculated_at: Date
}
```

### 4.4 后端API设计

**RFM分析API**：

```
GET  /api/customers/{customer_id}/rfm           # 获取客户RFM分析
GET  /api/analytics/rfm-segments                # 获取客户分群统计
POST /api/analytics/rfm-recalculate             # 重新计算所有客户RFM
GET  /api/analytics/rfm-segments/:segment       # 获取指定分群的客户列表
```

### 4.5 验收标准

**功能验收**：
- [ ] RFM三个维度计算准确
- [ ] 客户分群逻辑正确
- [ ] 客户价值评分准确
- [ ] 营销策略建议合理
- [ ] 客户分群统计正确
- [ ] 支持批量重新计算RFM

**准确性验收**：
- [ ] R值（天数）计算准确
- [ ] F值（订单数）统计正确
- [ ] M值（消费金额）统计准确
- [ ] 客户分群准确率 > 95%

**性能验收**：
- [ ] RFM计算响应时间 < 500ms
- [ ] 1000个客户分群统计 < 2秒
- [ ] 批量计算支持10,000+客户

---

## 📋 模块5: 客户生命周期管理

### 5.1 功能概述

管理客户从首次接触到流失的完整生命周期，在不同阶段提供针对性的服务和营销策略。

**参考对标**：
- HubSpot：客户生命周期阶段管理
- Salesforce：客户旅程管理

### 5.2 功能需求

#### 5.2.1 生命周期阶段定义

**F5-1: 生命周期阶段划分**

将客户生命周期划分为7个阶段：

| 阶段 | 定义 | 识别标准 | 目标 |
|-----|------|---------|------|
| 🌱 访客期 | 首次访问网站，未注册 | 无订单，无咨询 | 引导注册和咨询 |
| 🔍 潜客期 | 浏览产品，发起咨询 | 有咨询，无订单 | 促成首单 |
| 🎁 新客期 | 完成首次购买 | 订单数 = 1，< 30天 | 引导复购 |
| ⭐ 成长期 | 多次购买，逐步活跃 | 订单数 2-4，活跃 | 提升频次和客单价 |
| 💎 成熟期 | 高频购买，高价值 | 订单数 ≥ 5，活跃 | 维持忠诚度 |
| 😴 沉睡期 | 长时间未互动 | 90-180天未互动 | 唤醒激活 |
| 💤 流失期 | 失去联系 | > 180天未互动 | 流失挽回 |

**F5-2: 阶段自动识别**

系统自动判断客户当前所处阶段：

**判断逻辑**：
```python
def identify_lifecycle_stage(customer):
    if customer.total_orders == 0:
        if customer.has_consulted:
            return "潜客期"
        else:
            return "访客期"

    days_since_last_order = (now - customer.last_order_date).days

    if customer.total_orders == 1:
        if days_since_last_order <= 30:
            return "新客期"
        elif days_since_last_order <= 90:
            return "成长期"

    if customer.total_orders >= 5:
        if days_since_last_order <= 60:
            return "成熟期"

    if 90 <= days_since_last_order <= 180:
        return "沉睡期"

    if days_since_last_order > 180:
        return "流失期"

    return "成长期"
```

#### 5.2.2 阶段策略管理

**F5-3: 各阶段营销策略**

为每个阶段制定专属策略：

**访客期策略**：
- 目标：引导注册和首次咨询
- 动作：
  - 弹窗优惠：首单优惠券
  - 在线客服：主动邀请对话
  - 内容营销：推送购买指南

**潜客期策略**：
- 目标：促成首单
- 动作：
  - 限时折扣：24小时内下单优惠
  - 免费配送：满额包邮
  - 客户评价：展示真实用户反馈
  - 专人跟进：坐席主动联系

**新客期策略**：
- 目标：引导复购
- 动作：
  - 满意度调查：收集首购体验
  - 配件推荐：推荐充电器、锁具等
  - 会员邀请：邀请加入会员计划
  - 关怀服务：30天内主动回访

**成长期策略**：
- 目标：提升频次和客单价
- 动作：
  - 组合优惠：购买多件享折扣
  - 新品推荐：优先推送新款
  - 积分激励：积分兑换礼品
  - 社群运营：邀请加入骑友群

**成熟期策略**：
- 目标：维持忠诚度
- 动作：
  - VIP专属：专属客服和特权
  - 定制服务：个性化产品定制
  - 会员活动：线下骑行活动
  - 推荐奖励：老带新奖励

**沉睡期策略**：
- 目标：唤醒激活
- 动作：
  - 唤醒邮件：发送"我们想念你"邮件
  - 优惠刺激：发放大额优惠券
  - 新品通知：推送新品上市信息
  - 电话回访：坐席主动致电

**流失期策略**：
- 目标：流失挽回
- 动作：
  - 流失调研：了解流失原因
  - 挽回优惠：最大力度折扣
  - 产品改进：根据反馈改进
  - 情感营销：品牌故事和情怀

**F5-4: 自动化触发**

在客户进入特定阶段时，自动触发相应动作：

**触发器配置**：
```typescript
interface LifecycleTrigger {
  trigger_id: string
  stage: string                    // 生命周期阶段
  condition: string                // 触发条件
  action_type: string              // 动作类型: email/notification/task
  action_config: {
    template: string               // 邮件模板/消息模板
    delay_hours: number            // 延迟触发（小时）
    assigned_to?: string           // 分配给坐席
  }
  enabled: boolean
}
```

**示例触发器**：
```
触发器1: 新客30天未复购
  - 条件: 订单数=1 且 距首单30天
  - 动作: 发送复购优惠券邮件
  - 延迟: 0小时（立即触发）

触发器2: 客户进入沉睡期
  - 条件: 90天未互动
  - 动作: 创建唤醒任务，分配给客服主管
  - 延迟: 0小时

触发器3: 高价值客户流失预警
  - 条件: VIP客户 且 60天未互动
  - 动作: 浏览器通知 + 创建高优先级任务
  - 延迟: 0小时
```

#### 5.2.3 流失预警与挽回

**F5-5: 流失风险评估**

基于多个维度评估客户流失风险：

**风险指标**：

| 指标 | 权重 | 高风险标准 |
|-----|------|-----------|
| 距离上次购买天数 | 35% | > 90天 |
| 距离上次互动天数 | 25% | > 60天 |
| 购买频率下降 | 20% | 比历史平均低50% |
| 满意度评分 | 15% | < 3星 |
| 投诉记录 | 5% | 有未解决投诉 |

**流失风险等级**：

| 风险等级 | 综合得分 | 标识 | 动作 |
|---------|---------|------|------|
| 极高 | > 80分 | 🚨 | 立即人工介入 |
| 高 | 60-80分 | ⚠️ | 24小时内联系 |
| 中 | 40-60分 | 🔔 | 3天内关怀 |
| 低 | 20-40分 | 💡 | 定期观察 |
| 无 | < 20分 | ✅ | 正常维护 |

**F5-6: 流失预警通知**

当检测到客户流失风险时，及时通知相关人员：

**通知对象**：
- 客户所属坐席
- 客服主管
- 营销团队

**通知方式**：
- 浏览器推送
- 邮件通知
- 工作台红点提示

**通知内容**：
```
🚨 流失预警

客户: John Doe (VIP - Gold)
风险等级: 高 (75分)
风险原因:
  • 90天未购买（上次购买: 2024-10-28）
  • 60天未互动（上次咨询: 2024-11-27）
  • 有1个未解决投诉

建议动作:
  • 24小时内电话回访
  • 提供专属挽回优惠
  • 了解流失原因并记录

[查看详情] [创建任务]
```

**F5-7: 挽回效果追踪**

追踪流失挽回活动的效果：

**追踪指标**：
- 联系成功率：成功联系到客户的比例
- 挽回成功率：客户重新下单的比例
- 平均挽回成本：挽回一个客户的平均成本
- 挽回客户CLV：挽回客户的后续价值

**效果展示**：
```
┌─────────────────────────────────────┐
│ 流失挽回效果统计（本月）             │
├─────────────────────────────────────┤
│                                      │
│ 流失预警客户: 50人                   │
│ 已联系: 45人 (90%)                   │
│ 挽回成功: 20人 (44%)                 │
│ 平均挽回成本: $50/人                 │
│ 挽回客户贡献: $15,000               │
│ ROI: 600%                            │
│                                      │
│ [查看详情] [导出报表]                │
└─────────────────────────────────────┘
```

### 5.3 数据模型

**生命周期管理模型**：

```typescript
interface CustomerLifecycle {
  customer_id: string

  // 当前阶段
  current_stage: {
    stage: string                  // 阶段名称
    stage_id: string               // 阶段ID
    entered_at: Date               // 进入时间
    days_in_stage: number          // 停留天数
  }

  // 阶段历史
  stage_history: Array<{
    stage: string
    entered_at: Date
    exited_at: Date
    duration_days: number
  }>

  // 流失风险
  churn_risk: {
    score: number                  // 风险分数 (0-100)
    level: string                  // 风险等级
    factors: Array<{
      factor: string
      weight: number
      value: number
    }>
    predicted_churn_date: Date     // 预计流失日期
  }

  // 营销活动
  marketing_activities: Array<{
    activity_id: string
    activity_type: string
    triggered_at: Date
    completed: boolean
    result: string
  }>

  // 价值指标
  lifetime_value: {
    current_clv: number            // 当前CLV
    predicted_clv: number          // 预测CLV
    acquisition_cost: number       // 获客成本
    roi: number                    // ROI
  }

  updated_at: Date
}
```

### 5.4 后端API设计

**生命周期管理API**：

```
GET  /api/customers/{customer_id}/lifecycle         # 获取生命周期信息
GET  /api/analytics/lifecycle-stages                # 获取各阶段客户统计
GET  /api/analytics/churn-risk                      # 获取流失风险客户列表
POST /api/analytics/churn-risk/calculate            # 批量计算流失风险
POST /api/customers/{customer_id}/lifecycle/action  # 触发生命周期动作
GET  /api/analytics/retention-report                # 获取留存报告
```

### 5.5 UI设计

**生命周期展示**：

```
┌─────────────────────────────────────────┐
│ 客户生命周期                             │
├─────────────────────────────────────────┤
│                                          │
│ 当前阶段: 💎 成熟期 (已停留 180天)      │
│                                          │
│ 生命周期旅程:                            │
│ 🌱 → 🔍 → 🎁 → ⭐ → 💎                 │
│ 访客  潜客  新客  成长  成熟             │
│ 1天   7天  30天  90天  180天            │
│                                          │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                          │
│ 流失风险评估:                            │
│ 风险等级: ✅ 低风险 (15分)              │
│                                          │
│ 风险因素:                                │
│ • 距上次购买: 15天 ✅                   │
│ • 距上次互动: 5天 ✅                    │
│ • 购买频率: 正常 ✅                     │
│ • 满意度: 5星 ✅                        │
│                                          │
│ 下一步建议:                              │
│ 💡 定期关怀，维持现状                    │
│ 💡 推荐新品，刺激复购                    │
│                                          │
│ 客户价值:                                │
│ 当前CLV: $6,500                          │
│ 预测CLV: $12,000                         │
│ ROI: 650%                                │
│                                          │
└─────────────────────────────────────────┘
```

### 5.6 验收标准

**功能验收**：
- [ ] 生命周期阶段自动识别准确
- [ ] 阶段历史记录完整
- [ ] 各阶段策略正确配置
- [ ] 自动触发器正常工作
- [ ] 流失风险评估准确度 > 85%
- [ ] 流失预警及时触发（延迟 < 1小时）
- [ ] 挽回效果追踪完整

**准确性验收**：
- [ ] 生命周期阶段判断准确率 > 95%
- [ ] 流失风险预测准确率 > 85%
- [ ] CLV预测误差 < 20%

**性能验收**：
- [ ] 生命周期计算响应时间 < 500ms
- [ ] 流失风险批量计算支持10,000+客户
- [ ] 触发器延迟 < 1分钟

---

## 🔗 与其他模块的关系

**依赖关系**：
- **依赖**: L2-2-Part1 客户基础信息与行为
- **依赖**: L2-1 Shopify订单集成
- **被依赖**: L3-1 数据分析与报表（使用客户分析数据）

**数据流**：
```
客户基础信息 + 订单数据 + 行为数据
  ↓
购买偏好分析
  ↓
RFM客户分析
  ↓
客户生命周期管理
  ↓
营销策略执行 + 流失预警
```

---

## 📊 开发优先级

### 第一阶段（P0 - 必须实现）
- [ ] 生命周期阶段定义和自动识别
- [ ] RFM基础计算
- [ ] 客户分群（基础8个群体）
- [ ] 流失风险评估

### 第二阶段（P1 - 重要）
- [ ] 购买偏好分析（产品类型、颜色）
- [ ] 购买意向评分
- [ ] 生命周期自动触发器
- [ ] 流失预警通知

### 第三阶段（P2 - 优化）
- [ ] 价格敏感度分析
- [ ] 购买周期预测
- [ ] 决策因素识别
- [ ] 挽回效果追踪
- [ ] CLV预测

---

## 🧪 测试要点

### 单元测试
- RFM评分计算逻辑
- 生命周期阶段判断逻辑
- 流失风险评分算法
- CLV预测模型

### 集成测试
- 客户分群完整流程
- 自动触发器执行
- 流失预警通知
- 数据统计准确性

### 性能测试
- 10,000客户RFM批量计算
- 1,000客户流失风险评估
- 并发查询客户分析数据

---

## 📝 实施注意事项

### 技术约束
1. **实时计算 vs 定时计算**：RFM和生命周期每日批量计算一次，缓存结果
2. **数据隐私**：客户分析数据加密存储，遵守GDPR
3. **算法可调**：RFM阈值、流失风险权重可后台配置
4. **性能优化**：使用Redis缓存分析结果，TTL 24小时

### 开发建议
1. 先实现RFM分析，再实现生命周期管理
2. 先实现手动计算，再实现自动触发
3. 使用定时任务每日凌晨批量计算
4. 流失预警实时计算，使用消息队列

### Fiido 电动自行车业务特点
- 复购周期长（6-12个月）：调整RFM阈值
- 客单价高：重视高价值客户维护
- 决策周期长：购买意向判断需综合多个因素
- 售后关怀重要：影响复购和口碑

---

## 📚 参考资料

- **RFM模型**: https://en.wikipedia.org/wiki/RFM_(market_research)
- **客户生命周期管理**: https://www.hubspot.com/customer-lifecycle
- **流失预测**: https://towardsdatascience.com/churn-prediction
- **技术约束**: `prd/02_约束与原则/CONSTRAINTS_AND_PRINCIPLES.md`
- **API契约**: `prd/03_技术方案/api_contract.md`

---

**下一步**: 阅读 `L2-3-Part1_知识库管理.md`

**文档维护者**: Claude Code
**最后更新**: 2025-01-27
