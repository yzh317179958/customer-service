# [功能名称] - 跨模块技术栈

> **文档类型**：跨模块功能技术栈
> **创建日期**：YYYY-MM-DD
> **涉及模块**：[模块1]、[模块2]、...

---

## 一、复用现有技术栈

| 层级 | 技术/服务 | 用途 |
|------|----------|------|
| 产品层 | products/ai_chatbot | [用途描述] |
| 产品层 | products/agent_workbench | [用途描述] |
| 服务层 | services/session | [用途描述] |
| 服务层 | services/ticket | [用途描述] |
| 基础设施层 | infrastructure/bootstrap | [用途描述] |
| 基础设施层 | infrastructure/database | [用途描述] |
| 数据存储 | Redis | [用途描述] |
| 数据存储 | PostgreSQL | [用途描述] |

---

## 二、新增依赖

| 依赖 | 版本 | 用途 | 原因 |
|------|------|------|------|
| 无 | - | - | 优先复用现有技术栈 |
| [或填写新依赖名] | [版本] | [用途] | [为什么需要] |

---

## 三、跨模块通信方案

### 3.1 通信方式选型

| 方式 | 优点 | 缺点 | 是否采用 |
|------|------|------|----------|
| Redis Pub/Sub | 实时、简单、项目已有 | 消息不持久化 | ✅ / ❌ |
| HTTP API | 简单直接 | 延迟较高、服务耦合 | ✅ / ❌ |
| 消息队列(Redis Stream) | 可靠、持久化 | 复杂度高 | ✅ / ❌ |
| 共享数据库 | 实现简单 | 耦合度高 | ✅ / ❌ |
| SSE 事件流 | 实时推送 | 单向通信 | ✅ / ❌ |

### 3.2 选定方案

**通信方式**：[选定的方式]

**选择理由**：[为什么选择这种方式]

### 3.3 消息格式

```json
{
  "type": "[消息类型]",
  "source": "[发送方模块]",
  "target": "[接收方模块]",
  "payload": {
    // 具体数据
  },
  "timestamp": 1703246400
}
```

### 3.4 Channel/Topic 命名规范

| 模式 | 用途 | 示例 |
|------|------|------|
| `[功能]:[模块]:{id}` | [用途] | `sse:session:user_123` |
| `[功能]:broadcast` | 广播消息 | `notification:broadcast` |

---

## 四、数据存储方案

### 4.1 Redis 数据结构

| Key 模式 | 数据类型 | 用途 | TTL |
|----------|----------|------|-----|
| `[前缀]:{id}` | String/Hash | [用途] | [过期时间] |
| `[前缀]:list:{id}` | List | [用途] | [过期时间] |
| `[前缀]:set:{id}` | Set | [用途] | [过期时间] |

### 4.2 数据库表（如需要）

| 表名 | 用途 | 主要字段 |
|------|------|----------|
| [表名] | [用途] | id, created_at, ... |

### 4.3 数据同步策略

```
写入流程：
1. [步骤1]
2. [步骤2]

读取流程：
1. [步骤1]
2. [步骤2]
```

---

## 五、API 设计

### 5.1 模块间内部 API

| 模块 | 方法 | 路径 | 说明 |
|------|------|------|------|
| [模块1] | POST | /api/xxx | [说明] |
| [模块2] | GET | /api/yyy | [说明] |

### 5.2 对外 API（如有）

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| POST | /api/public/xxx | [说明] | [认证方式] |

---

## 六、安全考虑

### 6.1 认证授权

- [认证方式]
- [权限控制]

### 6.2 数据安全

- [敏感数据处理]
- [日志脱敏]

---

## 七、性能与可靠性

### 7.1 性能要求

| 指标 | 目标值 |
|------|--------|
| 响应时间 | < [X]ms |
| 并发量 | [X] QPS |

### 7.2 容错策略

| 场景 | 处理方式 |
|------|----------|
| [服务不可用] | [降级策略] |
| [数据库故障] | [备用方案] |

---

## 文档历史

| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|----------|
| v1.0 | YYYY-MM-DD | [作者] | 初稿 |
