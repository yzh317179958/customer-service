# 架构迁移计划

> **创建时间**：2025-12-18
> **状态**：已完成 ✅

---

## 一、迁移策略

采用**兼容层迁移**策略：

1. 将源文件复制到新架构目录
2. 更新新文件内部的 import 路径
3. 将旧文件转换为兼容层（重导出新模块）
4. backend.py 无需修改，继续使用旧 import 路径

---

## 二、迁移原则

1. **只迁移，不改功能** - 重构不改变任何业务逻辑
2. **保持向后兼容** - 旧 import 路径通过兼容层继续可用
3. **单向依赖** - products → services → infrastructure
4. **核心功能优先** - AI 客服模块优先保护

---

## 三、完成状态

### 阶段一：骨架搭建 ✅

- [x] 创建三层目录结构（products/services/infrastructure）
- [x] 创建各模块 README.md 骨架
- [x] 更新 CLAUDE.md 和 PROJECT_OVERVIEW.md

### 阶段二：代码迁移 ✅

| 模块 | 源位置 | 目标位置 | 状态 |
|------|--------|----------|------|
| 会话服务 | `src/session_state.py` 等 | `services/session/` | ✅ 完成 |
| Shopify 服务 | `src/shopify_*.py` | `services/shopify/` | ✅ 完成 |
| 邮件服务 | `src/email_service.py` | `services/email/` | ✅ 完成 |
| Coze 服务 | `src/oauth_token_manager.py` | `services/coze/` | ✅ 完成 |
| 工单服务 | `src/ticket*.py` | `services/ticket/` | ✅ 完成 |
| 安全认证 | `src/agent_auth.py` 等 | `infrastructure/security/` | ✅ 完成 |

### 阶段三：兼容层 ✅

所有 `src/*.py` 文件已转换为兼容层，重导出新架构模块。

---

## 四、验证结果

```
✅ 所有 import 测试通过
✅ backend.py 启动成功
✅ AI 客服功能正常运行
✅ 新旧 import 路径均可使用
```

---

## 五、兼容性说明

```python
# 旧路径（通过兼容层继续可用）
from src.shopify_service import ShopifyService

# 新路径（推荐）
from services.shopify import ShopifyService
```

---

## 六、相关文档

- [架构对比分析](./架构对比分析.md) - 新旧架构详细对比

---

*完成时间：2025-12-18*
